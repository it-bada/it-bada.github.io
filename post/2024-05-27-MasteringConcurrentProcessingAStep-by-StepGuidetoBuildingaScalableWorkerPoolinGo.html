<!DOCTYPE html><html lang="ko"><head><meta charSet="utf-8"/><title>Goì–¸ì–´ì—ì„œ í™•ì¥ ê°€ëŠ¥í•œ ì›Œì»¤ í’€ì„ êµ¬ì¶•í•˜ëŠ” ë°©ë²•ì„ ë‹¨ê³„ë³„ë¡œ ì•ˆë‚´í•˜ëŠ” Concurrent Processing ë§ˆìŠ¤í„°í•˜ê¸° | it-bada</title><meta name="description" content=""/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><meta property="og:url" content="https://it-bada.github.io///post/2024-05-27-MasteringConcurrentProcessingAStep-by-StepGuidetoBuildingaScalableWorkerPoolinGo" data-gatsby-head="true"/><meta property="og:type" content="website" data-gatsby-head="true"/><meta property="og:site_name" content="Goì–¸ì–´ì—ì„œ í™•ì¥ ê°€ëŠ¥í•œ ì›Œì»¤ í’€ì„ êµ¬ì¶•í•˜ëŠ” ë°©ë²•ì„ ë‹¨ê³„ë³„ë¡œ ì•ˆë‚´í•˜ëŠ” Concurrent Processing ë§ˆìŠ¤í„°í•˜ê¸° | it-bada" data-gatsby-head="true"/><meta property="og:title" content="Goì–¸ì–´ì—ì„œ í™•ì¥ ê°€ëŠ¥í•œ ì›Œì»¤ í’€ì„ êµ¬ì¶•í•˜ëŠ” ë°©ë²•ì„ ë‹¨ê³„ë³„ë¡œ ì•ˆë‚´í•˜ëŠ” Concurrent Processing ë§ˆìŠ¤í„°í•˜ê¸° | it-bada" data-gatsby-head="true"/><meta property="og:description" content="" data-gatsby-head="true"/><meta property="og:image" content="/assets/img/2024-05-27-MasteringConcurrentProcessingAStep-by-StepGuidetoBuildingaScalableWorkerPoolinGo_0.png" data-gatsby-head="true"/><meta property="og:locale" content="en_US" data-gatsby-head="true"/><meta name="twitter:card" content="summary_large_image" data-gatsby-head="true"/><meta property="twitter:domain" content="https://it-bada.github.io/" data-gatsby-head="true"/><meta property="twitter:url" content="https://it-bada.github.io///post/2024-05-27-MasteringConcurrentProcessingAStep-by-StepGuidetoBuildingaScalableWorkerPoolinGo" data-gatsby-head="true"/><meta name="twitter:title" content="Goì–¸ì–´ì—ì„œ í™•ì¥ ê°€ëŠ¥í•œ ì›Œì»¤ í’€ì„ êµ¬ì¶•í•˜ëŠ” ë°©ë²•ì„ ë‹¨ê³„ë³„ë¡œ ì•ˆë‚´í•˜ëŠ” Concurrent Processing ë§ˆìŠ¤í„°í•˜ê¸° | it-bada" data-gatsby-head="true"/><meta name="twitter:description" content="" data-gatsby-head="true"/><meta name="twitter:image" content="/assets/img/2024-05-27-MasteringConcurrentProcessingAStep-by-StepGuidetoBuildingaScalableWorkerPoolinGo_0.png" data-gatsby-head="true"/><meta name="twitter:data1" content="Dev | it-bada" data-gatsby-head="true"/><meta name="article:published_time" content="2024-05-27 19:52" data-gatsby-head="true"/><meta name="next-head-count" content="19"/><meta name="google-site-verification" content="a-yehRo3k3xv7fg6LqRaE8jlE42e5wP2bDE_2F849O4"/><link rel="stylesheet" href="/favicons/favicon.ico"/><link rel="icon" type="image/png" sizes="16x16" href="/assets/favicons/favicon-16x16.png"/><link rel="icon" type="image/png" sizes="32x32" href="/assets/favicons/favicon-32x32.png"/><link rel="icon" type="image/png" sizes="96x96" href="/assets/favicons/favicon-96x96.png"/><link rel="icon" href="/favicons/apple-icon-180x180.png"/><link rel="apple-touch-icon" href="/favicons/apple-icon-180x180.png"/><link rel="apple-touch-startup-image" href="/startup.png"/><meta name="apple-mobile-web-app-capable" content="yes"/><meta name="apple-mobile-web-app-status-bar-style" content="black"/><meta name="msapplication-config" content="/favicons/browserconfig.xml"/><script async="" src="https://www.googletagmanager.com/gtag/js?id=G-PDYZ2R0CH9"></script><script>window.dataLayer = window.dataLayer || [];
            function gtag(){dataLayer.push(arguments);}
            gtag('js', new Date());
          
            gtag('config', 'G-PDYZ2R0CH9');</script><link rel="preload" href="/_next/static/css/6e57edcf9f2ce551.css" as="style"/><link rel="stylesheet" href="/_next/static/css/6e57edcf9f2ce551.css" data-n-g=""/><link rel="preload" href="/_next/static/css/b8ef307c9aee1e34.css" as="style"/><link rel="stylesheet" href="/_next/static/css/b8ef307c9aee1e34.css" data-n-p=""/><noscript data-n-css=""></noscript><script defer="" nomodule="" src="/_next/static/chunks/polyfills-c67a75d1b6f99dc8.js"></script><script src="/_next/static/chunks/webpack-ee6df16fdc6dae4d.js" defer=""></script><script src="/_next/static/chunks/framework-46611630e39cfdeb.js" defer=""></script><script src="/_next/static/chunks/main-cf4a52eec9a970a0.js" defer=""></script><script src="/_next/static/chunks/pages/_app-6fae11262ee5c69b.js" defer=""></script><script src="/_next/static/chunks/75fc9c18-ac4aa08aae62f90e.js" defer=""></script><script src="/_next/static/chunks/463-0429087d4c0b0335.js" defer=""></script><script src="/_next/static/chunks/pages/post/%5Bslug%5D-90e194c785348efe.js" defer=""></script><script src="/_next/static/pS12KbT5cDEZt16dno2Ez/_buildManifest.js" defer=""></script><script src="/_next/static/pS12KbT5cDEZt16dno2Ez/_ssgManifest.js" defer=""></script></head><body><div id="__next"><header class="Header_header__Z8PUO"><div class="Header_inner__tfr0u"><strong class="Header_title__Otn70"><a href="/">IT Bada</a></strong><nav class="Header_nav_area__6KVpk"><a class="nav_item" href="/posts/1">Posts</a></nav></div></header><main class="posts_container__NyRU3"><div class="posts_inner__i3n_i"><h1 class="posts_post_title__EbxNx">Goì–¸ì–´ì—ì„œ í™•ì¥ ê°€ëŠ¥í•œ ì›Œì»¤ í’€ì„ êµ¬ì¶•í•˜ëŠ” ë°©ë²•ì„ ë‹¨ê³„ë³„ë¡œ ì•ˆë‚´í•˜ëŠ” Concurrent Processing ë§ˆìŠ¤í„°í•˜ê¸°</h1><div class="posts_meta__cR7lu"><div class="posts_profile_wrap__mslMl"><div class="posts_profile_image_wrap__kPikV"><img alt="Goì–¸ì–´ì—ì„œ í™•ì¥ ê°€ëŠ¥í•œ ì›Œì»¤ í’€ì„ êµ¬ì¶•í•˜ëŠ” ë°©ë²•ì„ ë‹¨ê³„ë³„ë¡œ ì•ˆë‚´í•˜ëŠ” Concurrent Processing ë§ˆìŠ¤í„°í•˜ê¸°" loading="lazy" width="44" height="44" decoding="async" data-nimg="1" class="profile" style="color:transparent" src="/favicons/apple-icon-114x114.png"/></div><div class="posts_textarea__w_iKT"><span class="writer">IT Bada</span><span class="posts_info__5KJdN"><span class="posts_date__ctqHI">Posted On May 27, 2024</span><span class="posts_reading_time__f7YPP">8<!-- --> min read</span></span></div></div><img alt="" loading="lazy" width="50" height="50" decoding="async" data-nimg="1" class="posts_view_badge__tcbfm" style="color:transparent" src="https://hits.seeyoufarm.com/api/count/incr/badge.svg?url=https%3A%2F%2Fallround-coder.github.io/post/2024-05-27-MasteringConcurrentProcessingAStep-by-StepGuidetoBuildingaScalableWorkerPoolinGo&amp;count_bg=%2379C83D&amp;title_bg=%23555555&amp;icon=&amp;icon_color=%23E7E7E7&amp;title=views&amp;edge_flat=false"/></div><article class="posts_post_content__n_L6j"><div><!doctype html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta content="width=device-width, initial-scale=1" name="viewport">
</head>
<body>
<p><strong>10,000ê°œì˜ ìš”ì²­ì„ ì´ˆë‹¹ ì²˜ë¦¬í•´ìš”!</strong></p>
<p>ğŸ¤ LinkedInì—ì„œ ì €ì™€ ì—°ê²°í•´ìš”. í™•ì¥ ê°€ëŠ¥í•œ ì‹œìŠ¤í…œì„ ë§Œë“¤ì–´ë´ìš”.</p>
<p>ì´ ë¸”ë¡œê·¸ í¬ìŠ¤íŠ¸ì—ì„œëŠ” Goë¥¼ ì‚¬ìš©í•˜ì—¬ í™•ì¥ ê°€ëŠ¥í•œ ì›Œì»¤ í’€ì„ êµ¬ì¶•í•´ë³¼ ê±°ì—ìš”. ì´ êµ¬í˜„ì€ ìš”ì²­ì˜ ëŒ€ëŸ‰ì„ ì²˜ë¦¬í•˜ê¸° ìœ„í•´ ì›Œì»¤ í’€ì„ íš¨ìœ¨ì ìœ¼ë¡œ ê´€ë¦¬í•˜ë©°, ë¶€í•˜ì— ë”°ë¼ ì›Œì»¤ ìˆ˜ë¥¼ ë™ì ìœ¼ë¡œ í™•ì¥í•©ë‹ˆë‹¤. ì ì¬ì ì¸ í•¨ì •ì— ëŒ€í•´ ë…¼í•˜ê³ , ê·¸ê²ƒë“¤ì„ í”¼í•˜ëŠ” ë°©ë²•ì— ëŒ€í•´ ì•Œì•„ë³¼ ê±°ì—ìš”.</p>
<h1>ê°œìš”</h1>
<div class="content-ad"></div>
<p>ìš°ë¦¬ëŠ” ë‹¤ìŒê³¼ ê°™ì€ ê¸°ëŠ¥ì„ ê°–ì¶˜ ì‘ì—…ì í’€ì„ ìƒì„±í•  ê²ƒì…ë‹ˆë‹¤:</p>
<ul>
<li>ë¶€í•˜ì— ë”°ë¼ ì‘ì—…ì ìˆ˜ë¥¼ ë™ì ìœ¼ë¡œ ì¡°ì ˆí•©ë‹ˆë‹¤.</li>
<li>ìš”ì²­ì„ íƒ€ì„ì•„ì›ƒ ë° ì¬ì‹œë„ ë©”ì»¤ë‹ˆì¦˜ìœ¼ë¡œ ì²˜ë¦¬í•©ë‹ˆë‹¤.</li>
<li>ì‘ì—…ìë¥¼ ìš°ì•„í•˜ê²Œ ì¢…ë£Œí•©ë‹ˆë‹¤.</li>
</ul>
<p>ë‹¤ìŒì€ ì™„ì „í•œ ì½”ë“œì™€ ê° ë¶€ë¶„ì— ëŒ€í•œ ì„¤ëª… ë° ë¬¸ì„œí™”ê°€ ì œê³µë©ë‹ˆë‹¤.</p>
<p><img src="/assets/img/2024-05-27-MasteringConcurrentProcessingAStep-by-StepGuidetoBuildingaScalableWorkerPoolinGo_0.png" alt="Mastering Concurrent Processing: A Step-by-Step Guide to Building a Scalable Worker Pool in Go"></p>
<div class="content-ad"></div>
<h1>ë””ìŠ¤íŒ¨ì²˜</h1>
<p>ë””ìŠ¤íŒ¨ì²˜ëŠ” ì‘ì—…ìë¥¼ ê´€ë¦¬í•˜ê³  ë“¤ì–´ì˜¤ëŠ” ìš”ì²­ì„ ë¶„ë°°í•˜ëŠ” ì—­í• ì„ í•©ë‹ˆë‹¤. í˜„ì¬ ë¶€í•˜ì— ë”°ë¼ ë™ì ìœ¼ë¡œ ì‘ì—…ìë¥¼ ì¶”ê°€í•˜ê±°ë‚˜ ì œê±°í•˜ë©° ëª¨ë“  ì‘ì—…ìë“¤ì„ ì›í™œí•˜ê²Œ ì¢…ë£Œí•©ë‹ˆë‹¤.</p>
<ul>
<li>AddWorker: í’€ì— ìƒˆ ì‘ì—…ìë¥¼ ì¶”ê°€í•˜ê³  ì‘ì—…ì ìˆ˜ë¥¼ ì¦ê°€ì‹œí‚µë‹ˆë‹¤. ì‘ì—…ìëŠ” ìš”ì²­ ì²˜ë¦¬ë¥¼ ì‹œì‘í•˜ê¸° ìœ„í•´ ì‹¤í–‰ë©ë‹ˆë‹¤.</li>
<li>RemoveWorker: ìµœì†Œ í•„ìš”í•œ ì‘ì—…ìë³´ë‹¤ ë§ì€ ê²½ìš° í’€ì—ì„œ ì‘ì—…ìë¥¼ ì œê±°í•©ë‹ˆë‹¤. ì‘ì—…ìëŠ” stopCh ì±„ë„ì„ í†µí•´ ì¤‘ì§€ë˜ë„ë¡ ì‹ í˜¸ë¥¼ ë³´ëƒ…ë‹ˆë‹¤.</li>
<li>ScaleWorkers: ë¶€í•˜ì— ë”°ë¼ ì‘ì—…ì ìˆ˜ë¥¼ ë™ì ìœ¼ë¡œ ì¡°ì •í•©ë‹ˆë‹¤. ë¶€í•˜ê°€ ì„ê³„ê°’ì„ ì´ˆê³¼í•˜ê³  ìµœëŒ€ í—ˆìš© ì‘ì—…ìë³´ë‹¤ ì‘ì€ ê²½ìš° ìƒˆ ì‘ì—…ìê°€ ì¶”ê°€ë©ë‹ˆë‹¤. ë¶€í•˜ê°€ ì„ê³„ê°’ ì•„ë˜ì´ê³  ìµœì†Œ í•„ìš”í•œ ì‘ì—…ìë³´ë‹¤ ë§ì€ ê²½ìš° ì‘ì—…ìê°€ ì œê±°ë©ë‹ˆë‹¤.</li>
<li>LaunchWorker: ì‘ì—…ìë¥¼ ì‹œì‘í•˜ê³  ì‘ì—…ì ìˆ˜ë¥¼ ì¦ê°€ì‹œí‚µë‹ˆë‹¤. ì¼ë°˜ì ìœ¼ë¡œ ì´ˆê¸° ì‘ì—…ì ì„¸íŠ¸ì— ì‚¬ìš©ë©ë‹ˆë‹¤.</li>
<li>MakeRequest: ì…ë ¥ ì±„ë„ì— ìš”ì²­ì„ ì¶”ê°€í•©ë‹ˆë‹¤. ì±„ë„ì´ ê°€ë“ ì°¬ ê²½ìš° ìš”ì²­ì€ ì‚­ì œë˜ê³  ë©”ì‹œì§€ê°€ ê¸°ë¡ë©ë‹ˆë‹¤.</li>
<li>Stop: ëª¨ë“  ì‘ì—…ìë¥¼ ì›í™œí•˜ê²Œ ì¤‘ì§€í•©ë‹ˆë‹¤. ëª¨ë“  ì‘ì—…ìê°€ í˜„ì¬ ìš”ì²­ ì²˜ë¦¬ë¥¼ ì™„ë£Œí•  ë•Œê¹Œì§€ ê¸°ë‹¤ë¦½ë‹ˆë‹¤. ì œí•œ ì‹œê°„ì— ë„ë‹¬í•˜ë©´ ëª¨ë“  ì‘ì—…ìë¥¼ ê°•ì œë¡œ ì¤‘ì§€í•©ë‹ˆë‹¤.</li>
</ul>
<h1>ì‘ì—…ì</h1>
<div class="content-ad"></div>
<p><strong>Worker êµ¬ì¡°ì²´ëŠ” ìš”ì²­ì„ ì²˜ë¦¬í•˜ëŠ” ì‘ì—…ìë¥¼ ë‚˜íƒ€ëƒ…ë‹ˆë‹¤. ê° ì‘ì—…ìëŠ” ìì‹ ë§Œì˜ ê³ ë£¨í‹´ì—ì„œ ì‹¤í–‰ë˜ë©° ì±„ë„ì—ì„œ ìˆ˜ì‹ ëœ ë“¤ì–´ì˜¤ëŠ” ìš”ì²­ì„ ì²­ì·¨í•©ë‹ˆë‹¤.</strong></p>
<ul>
<li><strong>LaunchWorker</strong>: ì‘ì—…ìë¥¼ ë³„ë„ì˜ ê³ ë£¨í‹´ìœ¼ë¡œ ì‹¤í–‰í•©ë‹ˆë‹¤. ì‘ì—…ìëŠ” ì…ë ¥ ì±„ë„ì´ ë‹«íˆê±°ë‚˜ ì •ì§€ ì‹ í˜¸ë¥¼ ë°›ì„ ë•Œê¹Œì§€ ë“¤ì–´ì˜¤ëŠ” ìš”ì²­ì„ ì²˜ë¦¬í•©ë‹ˆë‹¤.</li>
<li><strong>processRequest</strong>: ê°œë³„ ìš”ì²­ì„ ì²˜ë¦¬í•©ë‹ˆë‹¤. ì—ëŸ¬ê°€ ë°œìƒí•˜ê±°ë‚˜ ìš”ì²­ ì‹œê°„ì´ ì´ˆê³¼ë˜ì—ˆì„ ê²½ìš° ìµœëŒ€ ì§€ì •ëœ ì¬ì‹œë„ íšŸìˆ˜ê¹Œì§€ ìš”ì²­ì„ ë‹¤ì‹œ ì‹œë„í•©ë‹ˆë‹¤.</li>
</ul>
<p><strong>ì½”ë“œ</strong></p>
<pre><code class="hljs language-go"><span class="hljs-comment">// struct.go</span>

<span class="hljs-keyword">package</span> workerpool

<span class="hljs-keyword">import</span> <span class="hljs-string">"time"</span>

<span class="hljs-comment">// RequestëŠ” ì‘ì—…ìì— ì˜í•´ ì²˜ë¦¬ë  ìš”ì²­ì„ ë‚˜íƒ€ëƒ…ë‹ˆë‹¤.</span>
<span class="hljs-keyword">type</span> Request <span class="hljs-keyword">struct</span> {
    Handler    RequestHandler
    Type       <span class="hljs-type">int</span>
    Data       <span class="hljs-keyword">interface</span>{}
    Timeout    time.Duration <span class="hljs-comment">// ìš”ì²­ì˜ ì œí•œ ì‹œê°„</span>
    Retries    <span class="hljs-type">int</span>           <span class="hljs-comment">// ì¬ì‹œë„ íšŸìˆ˜</span>
    MaxRetries <span class="hljs-type">int</span>           <span class="hljs-comment">// ìµœëŒ€ ì¬ì‹œë„ íšŸìˆ˜</span>
}

<span class="hljs-comment">// RequestHandlerëŠ” ìš”ì²­ì„ ì²˜ë¦¬í•˜ëŠ” í•¨ìˆ˜ ìœ í˜•ì„ ì •ì˜í•©ë‹ˆë‹¤.</span>
<span class="hljs-keyword">type</span> RequestHandler <span class="hljs-function"><span class="hljs-keyword">func</span><span class="hljs-params">(<span class="hljs-keyword">interface</span>{})</span></span> <span class="hljs-type">error</span>
</code></pre>
<div class="content-ad"></div>
<h3>interface.go</h3>
<pre><code class="hljs language-go"><span class="hljs-keyword">package</span> workerpool

<span class="hljs-keyword">import</span> <span class="hljs-string">"context"</span>

<span class="hljs-comment">// WorkerLauncherëŠ” ì›Œì»¤ë¥¼ ì‹¤í–‰í•˜ê¸° ìœ„í•œ ì¸í„°í˜ì´ìŠ¤ì…ë‹ˆë‹¤.</span>
<span class="hljs-keyword">type</span> WorkerLauncher <span class="hljs-keyword">interface</span> {
 LaunchWorker(in <span class="hljs-keyword">chan</span> Request, stopCh <span class="hljs-keyword">chan</span> <span class="hljs-keyword">struct</span>{})
}

<span class="hljs-comment">// DispatcherëŠ” ì›Œì»¤ í’€ì„ ê´€ë¦¬í•˜ê¸° ìœ„í•œ ì¸í„°í˜ì´ìŠ¤ì…ë‹ˆë‹¤.</span>
<span class="hljs-keyword">type</span> Dispatcher <span class="hljs-keyword">interface</span> {
 AddWorker(w WorkerLauncher)
 RemoveWorker(minWorkers <span class="hljs-type">int</span>)
 LaunchWorker(id <span class="hljs-type">int</span>, w WorkerLauncher)
 ScaleWorkers(minWorkers, maxWorkers, loadThreshold <span class="hljs-type">int</span>)
 MakeRequest(Request)
 Stop(ctx context.Context)
}
</code></pre>
<h3>worker.go</h3>
<pre><code class="hljs language-go"><span class="hljs-keyword">package</span> workerpool

<span class="hljs-keyword">import</span> (
 <span class="hljs-string">"context"</span>
 <span class="hljs-string">"fmt"</span>
 <span class="hljs-string">"sync"</span>
 <span class="hljs-string">"time"</span>
)

<span class="hljs-comment">// WorkerëŠ” ìš”ì²­ì„ ì²˜ë¦¬í•˜ëŠ” ì›Œì»¤ë¥¼ ë‚˜íƒ€ëƒ…ë‹ˆë‹¤.</span>
<span class="hljs-keyword">type</span> Worker <span class="hljs-keyword">struct</span> {
 Id         <span class="hljs-type">int</span>
 Wg         *sync.WaitGroup
 ReqHandler <span class="hljs-keyword">map</span>[<span class="hljs-type">int</span>]RequestHandler
}

<span class="hljs-comment">// LaunchWorkerëŠ” ì›Œì»¤ë¥¼ ì‹¤í–‰í•˜ì—¬ ë“¤ì–´ì˜¤ëŠ” ìš”ì²­ì„ ì²˜ë¦¬í•©ë‹ˆë‹¤.</span>
<span class="hljs-comment">// ì´ëŠ” ë³„ë„ì˜ ê³ ë£¨í‹´ì—ì„œ ì‹¤í–‰ë˜ë©°, ì…ë ¥ ì±„ë„ì—ì„œ ë“¤ì–´ì˜¤ëŠ” ìš”ì²­ì„ ì§€ì†ì ìœ¼ë¡œ ìˆ˜ì‹ í•©ë‹ˆë‹¤.</span>
<span class="hljs-comment">// ì›Œì»¤ëŠ” ì…ë ¥ ì±„ë„ì´ ë‹«íˆê±°ë‚˜ ì¤‘ì§€ ì‹ í˜¸ë¥¼ ë°›ìœ¼ë©´ ì •ìƒì ìœ¼ë¡œ ì¢…ë£Œë©ë‹ˆë‹¤.</span>
<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-params">(w *Worker)</span></span> LaunchWorker(in <span class="hljs-keyword">chan</span> Request, stopCh <span class="hljs-keyword">chan</span> <span class="hljs-keyword">struct</span>{}) {
 <span class="hljs-keyword">go</span> <span class="hljs-function"><span class="hljs-keyword">func</span><span class="hljs-params">()</span></span> {
  <span class="hljs-keyword">defer</span> w.Wg.Done()
  <span class="hljs-keyword">for</span> {
   <span class="hljs-keyword">select</span> {
   <span class="hljs-keyword">case</span> msg, open := &#x3C;-in:
    <span class="hljs-keyword">if</span> !open {
     <span class="hljs-comment">// ì±„ë„ì´ ë‹«íˆë©´ ì²˜ë¦¬ë¥¼ ì¤‘ì§€í•˜ê³  ë°˜í™˜í•©ë‹ˆë‹¤.</span>
     fmt.Println(<span class="hljs-string">"ì›Œì»¤ ì¤‘ì§€:"</span>, w.Id)
     <span class="hljs-keyword">return</span>
    }
    w.processRequest(msg)
    time.Sleep(<span class="hljs-number">1</span> * time.Microsecond) <span class="hljs-comment">// ë°€ë¦¬ì´ˆ ë‹¨ìœ„ì˜ ì‘ì€ ì§€ì—°</span>
   <span class="hljs-keyword">case</span> &#x3C;-stopCh:
    fmt.Println(<span class="hljs-string">"ì›Œì»¤ ì¤‘ì§€:"</span>, w.Id)
    <span class="hljs-keyword">return</span>
   }
  }
 }()
}

<span class="hljs-comment">// processRequestëŠ” í•˜ë‚˜ì˜ ìš”ì²­ì„ ì²˜ë¦¬í•©ë‹ˆë‹¤.</span>
<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-params">(w *Worker)</span></span> processRequest(msg Request) {
 fmt.Printf(<span class="hljs-string">"ì›Œì»¤ %dê°€ ìš”ì²­ ì²˜ë¦¬ ì¤‘: %v\n"</span>, w.Id, msg)
 <span class="hljs-keyword">var</span> handler RequestHandler
 <span class="hljs-keyword">var</span> ok <span class="hljs-type">bool</span>
 <span class="hljs-keyword">if</span> handler, ok = w.ReqHandler[msg.Type]; !ok {
  fmt.Println(<span class="hljs-string">"í•¸ë“¤ëŸ¬ê°€ êµ¬í˜„ë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤: ì›Œì»¤ID:"</span>, w.Id)
 } <span class="hljs-keyword">else</span> {
  <span class="hljs-keyword">if</span> msg.Timeout == <span class="hljs-number">0</span> {
   msg.Timeout = time.Duration(<span class="hljs-number">10</span> * time.Millisecond) <span class="hljs-comment">// ê¸°ë³¸ íƒ€ì„ì•„ì›ƒ</span>
  }
  <span class="hljs-keyword">for</span> attempt := <span class="hljs-number">0</span>; attempt &#x3C;= msg.MaxRetries; attempt++ {
   <span class="hljs-keyword">var</span> err <span class="hljs-type">error</span>
   done := <span class="hljs-built_in">make</span>(<span class="hljs-keyword">chan</span> <span class="hljs-keyword">struct</span>{})
   ctx, cancel := context.WithTimeout(context.Background(), msg.Timeout)
   <span class="hljs-keyword">defer</span> cancel()

   <span class="hljs-keyword">go</span> <span class="hljs-function"><span class="hljs-keyword">func</span><span class="hljs-params">()</span></span> {
    err = handler(msg.Data)
    <span class="hljs-built_in">close</span>(done)
   }()

   <span class="hljs-keyword">select</span> {
   <span class="hljs-keyword">case</span> &#x3C;-done:
    <span class="hljs-keyword">if</span> err == <span class="hljs-literal">nil</span> {
     <span class="hljs-keyword">return</span> <span class="hljs-comment">// ì„±ê³µì ìœ¼ë¡œ ì²˜ë¦¬</span>
    }
    fmt.Printf(<span class="hljs-string">"ì›Œì»¤ %d: ìš”ì²­ ì²˜ë¦¬ ì¤‘ ì˜¤ë¥˜: %v\n"</span>, w.Id, err)
   <span class="hljs-keyword">case</span> &#x3C;-ctx.Done():
    fmt.Printf(<span class="hljs-string">"ì›Œì»¤ %d: ìš”ì²­ ì²˜ë¦¬ ì‹œê°„ ì´ˆê³¼: %v\n"</span>, w.Id, msg.Data)
   }
   fmt.Printf(<span class="hljs-string">"ì›Œì»¤ %d: ìš”ì²­ %vì— ëŒ€í•œ ì¬ì‹œë„ %d\n"</span>, w.Id, attempt, msg.Data)
  }
  fmt.Printf(<span class="hljs-string">"ì›Œì»¤ %d: %dë²ˆ ì¬ì‹œë„ í›„ ìš”ì²­ %v ì²˜ë¦¬ ì‹¤íŒ¨\n"</span>, w.Id, msg.MaxRetries, msg.Data)
 }
}
</code></pre>
<h3>dispatcher.go</h3>
<pre><code class="hljs language-go"><span class="hljs-keyword">package</span> workerpool

<span class="hljs-keyword">import</span> (
 <span class="hljs-string">"context"</span>
 <span class="hljs-string">"fmt"</span>
 <span class="hljs-string">"sync"</span>
 <span class="hljs-string">"time"</span>
)

<span class="hljs-comment">// ReqHandlerëŠ” ìš”ì²­ íƒ€ì…ë³„ë¡œ ë§¤í•‘ëœ í•¸ë“¤ëŸ¬ ë§µì…ë‹ˆë‹¤.</span>
<span class="hljs-keyword">var</span> ReqHandler = <span class="hljs-keyword">map</span>[<span class="hljs-type">int</span>]RequestHandler{
 <span class="hljs-number">1</span>: <span class="hljs-function"><span class="hljs-keyword">func</span><span class="hljs-params">(data <span class="hljs-keyword">interface</span>{})</span></span> <span class="hljs-type">error</span> {
  <span class="hljs-keyword">return</span> <span class="hljs-literal">nil</span>
 },
}

<span class="hljs-comment">// dispatcherëŠ” ì›Œì»¤ í’€ì„ ê´€ë¦¬í•˜ê³  ë“¤ì–´ì˜¤ëŠ” ìš”ì²­ì„ ì›Œì»¤ë“¤ ì‚¬ì´ì— ë¶„ë°°í•˜ëŠ” ì—­í• ì„ í•©ë‹ˆë‹¤.</span>
<span class="hljs-keyword">type</span> dispatcher <span class="hljs-keyword">struct</span> {
 inCh        <span class="hljs-keyword">chan</span> Request
 wg          *sync.WaitGroup
 mu          sync.Mutex
 workerCount <span class="hljs-type">int</span>
 stopCh      <span class="hljs-keyword">chan</span> <span class="hljs-keyword">struct</span>{} <span class="hljs-comment">// ì›Œì»¤ì— ì¤‘ì§€ ì‹ í˜¸ë¥¼ ë³´ë‚´ê¸° ìœ„í•œ ì±„ë„</span>
}

<span class="hljs-comment">// AddWorkerëŠ” ìƒˆë¡œìš´ ì›Œì»¤ë¥¼ í’€ì— ì¶”ê°€í•˜ê³  ì›Œì»¤ ìˆ˜ë¥¼ ì¦ê°€ì‹œí‚µë‹ˆë‹¤.</span>
<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-params">(d *dispatcher)</span></span> AddWorker(w WorkerLauncher) {
 d.mu.Lock()
 <span class="hljs-keyword">defer</span> d.mu.Unlock()
 d.workerCount++
 d.wg.Add(<span class="hljs-number">1</span>)
 w.LaunchWorker(d.inCh, d.stopCh)
}

<span class="hljs-comment">// RemoveWorkerëŠ” ì›Œì»¤ ìˆ˜ê°€ minWorkersë³´ë‹¤ í° ê²½ìš° ì›Œì»¤ë¥¼ í’€ì—ì„œ ì œê±°í•©ë‹ˆë‹¤.</span>
<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-params">(d *dispatcher)</span></span> RemoveWorker(minWorkers <span class="hljs-type">int</span>) {
 d.mu.Lock()
 <span class="hljs-keyword">defer</span> d.mu.Unlock()
 <span class="hljs-keyword">if</span> d.workerCount > minWorkers {
  d.workerCount--
  d.stopCh &#x3C;- <span class="hljs-keyword">struct</span>{}{} <span class="hljs-comment">// ì›Œì»¤ì— ì¤‘ì§€ ì‹ í˜¸ ì „ì†¡</span>
 }
}

<span class="hljs-comment">// ScaleWorkersëŠ” í˜„ì¬ ë¶€í•˜ì— ë”°ë¼ ì›Œì»¤ ìˆ˜ë¥¼ ë™ì ìœ¼ë¡œ ì¡°ì •í•©ë‹ˆë‹¤.</span>
<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-params">(d *dispatcher)</span></span> ScaleWorkers(minWorkers, maxWorkers, loadThreshold <span class="hljs-type">int</span>) {
 ticker := time.NewTicker(time.Microsecond)
 <span class="hljs-keyword">defer</span> ticker.Stop()

 <span class="hljs-keyword">for</span> <span class="hljs-keyword">range</span> ticker.C {
  load := <span class="hljs-built_in">len</span>(d.inCh) <span class="hljs-comment">// í˜„ì¬ ë¶€í•˜ëŠ” ì±„ë„ì— ëŒ€ê¸° ì¤‘ì¸ ìš”ì²­ ìˆ˜</span>
  <span class="hljs-keyword">if</span> load > loadThreshold &#x26;&#x26; d.workerCount &#x3C; maxWorkers {
   fmt.Println(<span class="hljs-string">"ìŠ¤ì¼€ì¼ë§ íŠ¸ë¦¬ê±°"</span>)
   newWorker := &#x26;Worker{
    Wg:         d.wg,
    Id:         d.workerCount,
    ReqHandler: ReqHandler,
   }
   d.AddWorker(newWorker)
  } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> load &#x3C; <span class="hljs-number">0.75</span>*loadThreshold &#x26;&#x26; d.workerCount > minWorkers {
   fmt.Println(<span class="hljs-string">"ì¶•ì†Œ íŠ¸ë¦¬ê±°"</span>)
   d.RemoveWorker(minWorkers)
  }
 }
}

<span class="hljs-comment">// LaunchWorkerëŠ” ì›Œì»¤ë¥¼ ì‹œì‘í•˜ê³  ì›Œì»¤ ìˆ˜ë¥¼ ì¦ê°€ì‹œí‚µë‹ˆë‹¤.</span>
<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-params">(d *dispatcher)</span></span> LaunchWorker(id <span class="hljs-type">int</span>, w WorkerLauncher) {
 w.LaunchWorker(d.inCh, d.stopCh) <span class="hljs-comment">// ì¤‘ì§€ ì±„ë„ì„ ì›Œì»¤ì— ì „ë‹¬</span>
 d.mu.Lock()
 d.workerCount++
 d.mu.Unlock()
}

<span class="hljs-comment">// MakeRequestëŠ” ìš”ì²­ì„ ì…ë ¥ ì±„ë„ì— ì¶”ê°€í•˜ê±°ë‚˜ ì±„ë„ì´ ê°€ë“ ì°¬ ê²½ìš° ì‚­ì œí•©ë‹ˆë‹¤.</span>
<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-params">(d *dispatcher)</span></span> MakeRequest(r Request) {
 <span class="hljs-keyword">select</span> {
 <span class="hljs-keyword">case</span> d.inCh &#x3C;- r:
 <span class="hljs-keyword">default</span>:
  <span class="hljs-comment">// ì±„ë„ì´ ê°€ë“ ì°¬ ê²½ìš° ì²˜ë¦¬</span>
  fmt.Println(<span class="hljs-string">"ìš”ì²­ ì±„ë„ì´ ê°€ë“ ì°¼ìŠµë‹ˆë‹¤. ìš”ì²­ ì‚­ì œë¨."</span>)
  <span class="hljs-comment">// ë‹¤ë¥¸ ì¡°ì¹˜ë¥¼ ì·¨í•˜ê¸° ì „ì— ë¡œê¹…, ìš”ì²­ ë²„í¼ë§ ë˜ëŠ” ë‹¤ë¥¸ ì¡°ì¹˜ë¥¼ ì·¨í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</span>
 }
}

<span class="hljs-comment">// StopëŠ” ëª¨ë“  ì›Œì»¤ë¥¼ ì •ìƒì ìœ¼ë¡œ ì¢…ë£Œí•˜ê³  ì²˜ë¦¬ê°€ ì™„ë£Œë  ë•Œê¹Œì§€ ê¸°ë‹¤ë¦½ë‹ˆë‹¤.</span>
<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-params">(d *dispatcher)</span></span> Stop(ctx context.Context) {
 fmt.Println(<span class="hljs-string">"\nì¤‘ì§€ í˜¸ì¶œë¨"</span>)
 <span class="hljs-built_in">close</span>(d.inCh) <span class="hljs-comment">// ë” ì´ìƒ ìš”ì²­ì„ ë³´ë‚´ì§€ ì•ŠìŒì„ ì•Œë¦¬ê¸° ìœ„í•´ ì…ë ¥ ì±„ë„ ë‹«ê¸°</span>
 done := <span class="hljs-built_in">make</span>(<span class="hljs-keyword">chan</span> <span class="hljs-keyword">struct</span>{})

 <span class="hljs-keyword">go</span> <span class="hljs-function"><span class="hljs-keyword">func</span><span class="hljs-params">()</span></span> {
  d.wg.Wait() <span class="hljs-comment">// ëª¨ë“  ì›Œì»¤ê°€ ì¢…ë£Œë  ë•Œê¹Œì§€ ëŒ€ê¸°</span>
  <span class="hljs-built_in">close</span>(done)
 }()

 <span class="hljs-keyword">select</span> {
 <span class="hljs-keyword">case</span> &#x3C;-done:
  fmt.Println(<span class="hljs-string">"ëª¨ë“  ì›Œì»¤ê°€ ì •ìƒì ìœ¼ë¡œ ì¤‘ì§€ë¨"</span>)
 <span class="hljs-keyword">case</span> &#x3C;-ctx.Done():
  fmt.Println(<span class="hljs-string">"ì‹œê°„ ì´ˆê³¼, ê°•ì œ ì¢…ë£Œ"</span>)
  <span class="hljs-comment">// ì‹œê°„ ì´ˆê³¼ ì‹œ ëª¨ë“  ì›Œì»¤ ê°•ì œ ì¢…ë£Œ</span>
  <span class="hljs-keyword">for</span> i := <span class="hljs-number">0</span>; i &#x3C; d.workerCount; i++ {
   d.stopCh &#x3C;- <span class="hljs-keyword">struct</span>{}{}
  }
 }

 d.wg.Wait()
}

<span class="hljs-comment">// NewDispatcherëŠ” ë²„í¼ë§ëœ ì±„ë„ê³¼ ì›¨ì´íŠ¸ ê·¸ë£¹ì´ ìˆëŠ” ìƒˆë¡œìš´ ë””ìŠ¤íŒ¨ì²˜ë¥¼ ìƒì„±í•©ë‹ˆë‹¤.</span>
<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">NewDispatcher</span><span class="hljs-params">(b <span class="hljs-type">int</span>, wg *sync.WaitGroup, maxWorkers <span class="hljs-type">int</span>)</span></span> Dispatcher {
 <span class="hljs-keyword">return</span> &#x26;dispatcher{
  inCh:   <span class="hljs-built_in">make</span>(<span class="hljs-keyword">chan</span> Request, b),
  wg:     wg,
  stopCh: <span class="hljs-built_in">make</span>(<span class="hljs-keyword">chan</span> <span class="hljs-keyword">struct</span>{}, maxWorkers), <span class="hljs-comment">// ë¸”ë¡œí‚¹ì„ ë°©ì§€í•˜ê¸° ìœ„í•œ ë²„í¼ë§ëœ ì±„ë„</span>
 }
}
</code></pre>
<h3>main.go</h3>
<pre><code class="hljs language-go"><span class="hljs-keyword">package</span> main

<span class="hljs-keyword">import</span> (
 <span class="hljs-string">"context"</span>
 <span class="hljs-string">"fmt"</span>
 <span class="hljs-string">"runtime"</span>
 <span class="hljs-string">"sync"</span>
 <span class="hljs-string">"time"</span>
 wp <span class="hljs-string">"workerpool/workerpool"</span>
)



&#x3C;div class=<span class="hljs-string">"content-ad"</span>>&#x3C;/div>

# ë©”ì¸

ì£¼ìš” ê¸°ëŠ¥ì€ ë””ìŠ¤íŒ¨ì²˜ì™€ ì›Œì»¤ë¥¼ ì´ˆê¸°í™”í•˜ê³  ì‘ì—…ì„ ë³´ë‚´ë©°, ë””ìŠ¤íŒ¨ì²˜ë¥¼ ì›í™œí•˜ê²Œ ì¢…ë£Œí•©ë‹ˆë‹¤.

- GOMAXPROCSë¥¼ ì‚¬ìš© ê°€ëŠ¥í•œ CPU ìˆ˜ë¡œ ì„¤ì •í•©ë‹ˆë‹¤.
- ë””ìŠ¤íŒ¨ì²˜ë¥¼ ì´ˆê¸°í™”í•˜ê³  ì´ˆê¸° ì›Œì»¤ ì§‘í•©ì„ ì‹œì‘í•©ë‹ˆë‹¤.
- ë””ìŠ¤íŒ¨ì²˜ì— ìš”ì²­ì„ ë³´ëƒ…ë‹ˆë‹¤.
- íƒ€ì„ì•„ì›ƒì„ ì„¤ì •í•˜ì—¬ ë””ìŠ¤íŒ¨ì²˜ë¥¼ ì›í™œí•˜ê²Œ ì¢…ë£Œí•©ë‹ˆë‹¤.

ìš°ë¦¬ëŠ” ì»¨í…ìŠ¤íŠ¸ íƒ€ì„ì•„ì›ƒ, ë²„í¼ í¬ê¸°, ìµœì†Œ/ìµœëŒ€ ì›Œì»¤ì™€ ê°™ì€ ë§¤ê°œë³€ìˆ˜ë¥¼ ì¡°ì •í•˜ì—¬ ì´ˆë‹¹ ìš”ì²­(RPS)ì„ ìµœëŒ€í™”í•˜ê³  ì• í”Œë¦¬ì¼€ì´ì…˜ ì„±ëŠ¥ì„ í–¥ìƒì‹œí‚¬ ê²ƒì…ë‹ˆë‹¤.

&#x3C;div class=<span class="hljs-string">"content-ad"</span>>&#x3C;/div>

Stay tuned <span class="hljs-keyword">for</span> practical insights and <span class="hljs-built_in">real</span>-world examples!

If you<span class="hljs-string">'ve read up till now, I hope you enjoyed this article. If you did, please show your support by giving it a clap, as it helps me stay motivated to assist the community.

Feel free to leave a comment if you noticed any discrepancies in this article or if you have any questions related to the content.

Thank you for your time.

&#x3C;div class="content-ad">&#x3C;/div>

ë§ˆìŒì— ë“œì‹œëŠ” ì‚¬ëŒë“¤ê³¼ ì–¸ì œë“  ì—°ë½í•˜ì„¸ìš”! LinkedInì— ì—°ê²°í•´ë³´ëŠ” ê±´ ì–´ë– ì„¸ìš”? ğŸ¤
</span></code></pre>
</body>
</html>
</div></article></div></main></div><script id="__NEXT_DATA__" type="application/json">{"props":{"pageProps":{"post":{"title":"Goì–¸ì–´ì—ì„œ í™•ì¥ ê°€ëŠ¥í•œ ì›Œì»¤ í’€ì„ êµ¬ì¶•í•˜ëŠ” ë°©ë²•ì„ ë‹¨ê³„ë³„ë¡œ ì•ˆë‚´í•˜ëŠ” Concurrent Processing ë§ˆìŠ¤í„°í•˜ê¸°","description":"","date":"2024-05-27 19:52","slug":"2024-05-27-MasteringConcurrentProcessingAStep-by-StepGuidetoBuildingaScalableWorkerPoolinGo","content":"\n**10,000ê°œì˜ ìš”ì²­ì„ ì´ˆë‹¹ ì²˜ë¦¬í•´ìš”!**\n\nğŸ¤ LinkedInì—ì„œ ì €ì™€ ì—°ê²°í•´ìš”. í™•ì¥ ê°€ëŠ¥í•œ ì‹œìŠ¤í…œì„ ë§Œë“¤ì–´ë´ìš”.\n\nì´ ë¸”ë¡œê·¸ í¬ìŠ¤íŠ¸ì—ì„œëŠ” Goë¥¼ ì‚¬ìš©í•˜ì—¬ í™•ì¥ ê°€ëŠ¥í•œ ì›Œì»¤ í’€ì„ êµ¬ì¶•í•´ë³¼ ê±°ì—ìš”. ì´ êµ¬í˜„ì€ ìš”ì²­ì˜ ëŒ€ëŸ‰ì„ ì²˜ë¦¬í•˜ê¸° ìœ„í•´ ì›Œì»¤ í’€ì„ íš¨ìœ¨ì ìœ¼ë¡œ ê´€ë¦¬í•˜ë©°, ë¶€í•˜ì— ë”°ë¼ ì›Œì»¤ ìˆ˜ë¥¼ ë™ì ìœ¼ë¡œ í™•ì¥í•©ë‹ˆë‹¤. ì ì¬ì ì¸ í•¨ì •ì— ëŒ€í•´ ë…¼í•˜ê³ , ê·¸ê²ƒë“¤ì„ í”¼í•˜ëŠ” ë°©ë²•ì— ëŒ€í•´ ì•Œì•„ë³¼ ê±°ì—ìš”.\n\n# ê°œìš”\n\n\u003cdiv class=\"content-ad\"\u003e\u003c/div\u003e\n\nìš°ë¦¬ëŠ” ë‹¤ìŒê³¼ ê°™ì€ ê¸°ëŠ¥ì„ ê°–ì¶˜ ì‘ì—…ì í’€ì„ ìƒì„±í•  ê²ƒì…ë‹ˆë‹¤:\n\n- ë¶€í•˜ì— ë”°ë¼ ì‘ì—…ì ìˆ˜ë¥¼ ë™ì ìœ¼ë¡œ ì¡°ì ˆí•©ë‹ˆë‹¤.\n- ìš”ì²­ì„ íƒ€ì„ì•„ì›ƒ ë° ì¬ì‹œë„ ë©”ì»¤ë‹ˆì¦˜ìœ¼ë¡œ ì²˜ë¦¬í•©ë‹ˆë‹¤.\n- ì‘ì—…ìë¥¼ ìš°ì•„í•˜ê²Œ ì¢…ë£Œí•©ë‹ˆë‹¤.\n\në‹¤ìŒì€ ì™„ì „í•œ ì½”ë“œì™€ ê° ë¶€ë¶„ì— ëŒ€í•œ ì„¤ëª… ë° ë¬¸ì„œí™”ê°€ ì œê³µë©ë‹ˆë‹¤.\n\n![Mastering Concurrent Processing: A Step-by-Step Guide to Building a Scalable Worker Pool in Go](/assets/img/2024-05-27-MasteringConcurrentProcessingAStep-by-StepGuidetoBuildingaScalableWorkerPoolinGo_0.png)\n\n\u003cdiv class=\"content-ad\"\u003e\u003c/div\u003e\n\n# ë””ìŠ¤íŒ¨ì²˜\n\në””ìŠ¤íŒ¨ì²˜ëŠ” ì‘ì—…ìë¥¼ ê´€ë¦¬í•˜ê³  ë“¤ì–´ì˜¤ëŠ” ìš”ì²­ì„ ë¶„ë°°í•˜ëŠ” ì—­í• ì„ í•©ë‹ˆë‹¤. í˜„ì¬ ë¶€í•˜ì— ë”°ë¼ ë™ì ìœ¼ë¡œ ì‘ì—…ìë¥¼ ì¶”ê°€í•˜ê±°ë‚˜ ì œê±°í•˜ë©° ëª¨ë“  ì‘ì—…ìë“¤ì„ ì›í™œí•˜ê²Œ ì¢…ë£Œí•©ë‹ˆë‹¤.\n\n- AddWorker: í’€ì— ìƒˆ ì‘ì—…ìë¥¼ ì¶”ê°€í•˜ê³  ì‘ì—…ì ìˆ˜ë¥¼ ì¦ê°€ì‹œí‚µë‹ˆë‹¤. ì‘ì—…ìëŠ” ìš”ì²­ ì²˜ë¦¬ë¥¼ ì‹œì‘í•˜ê¸° ìœ„í•´ ì‹¤í–‰ë©ë‹ˆë‹¤.\n- RemoveWorker: ìµœì†Œ í•„ìš”í•œ ì‘ì—…ìë³´ë‹¤ ë§ì€ ê²½ìš° í’€ì—ì„œ ì‘ì—…ìë¥¼ ì œê±°í•©ë‹ˆë‹¤. ì‘ì—…ìëŠ” stopCh ì±„ë„ì„ í†µí•´ ì¤‘ì§€ë˜ë„ë¡ ì‹ í˜¸ë¥¼ ë³´ëƒ…ë‹ˆë‹¤.\n- ScaleWorkers: ë¶€í•˜ì— ë”°ë¼ ì‘ì—…ì ìˆ˜ë¥¼ ë™ì ìœ¼ë¡œ ì¡°ì •í•©ë‹ˆë‹¤. ë¶€í•˜ê°€ ì„ê³„ê°’ì„ ì´ˆê³¼í•˜ê³  ìµœëŒ€ í—ˆìš© ì‘ì—…ìë³´ë‹¤ ì‘ì€ ê²½ìš° ìƒˆ ì‘ì—…ìê°€ ì¶”ê°€ë©ë‹ˆë‹¤. ë¶€í•˜ê°€ ì„ê³„ê°’ ì•„ë˜ì´ê³  ìµœì†Œ í•„ìš”í•œ ì‘ì—…ìë³´ë‹¤ ë§ì€ ê²½ìš° ì‘ì—…ìê°€ ì œê±°ë©ë‹ˆë‹¤.\n- LaunchWorker: ì‘ì—…ìë¥¼ ì‹œì‘í•˜ê³  ì‘ì—…ì ìˆ˜ë¥¼ ì¦ê°€ì‹œí‚µë‹ˆë‹¤. ì¼ë°˜ì ìœ¼ë¡œ ì´ˆê¸° ì‘ì—…ì ì„¸íŠ¸ì— ì‚¬ìš©ë©ë‹ˆë‹¤.\n- MakeRequest: ì…ë ¥ ì±„ë„ì— ìš”ì²­ì„ ì¶”ê°€í•©ë‹ˆë‹¤. ì±„ë„ì´ ê°€ë“ ì°¬ ê²½ìš° ìš”ì²­ì€ ì‚­ì œë˜ê³  ë©”ì‹œì§€ê°€ ê¸°ë¡ë©ë‹ˆë‹¤.\n- Stop: ëª¨ë“  ì‘ì—…ìë¥¼ ì›í™œí•˜ê²Œ ì¤‘ì§€í•©ë‹ˆë‹¤. ëª¨ë“  ì‘ì—…ìê°€ í˜„ì¬ ìš”ì²­ ì²˜ë¦¬ë¥¼ ì™„ë£Œí•  ë•Œê¹Œì§€ ê¸°ë‹¤ë¦½ë‹ˆë‹¤. ì œí•œ ì‹œê°„ì— ë„ë‹¬í•˜ë©´ ëª¨ë“  ì‘ì—…ìë¥¼ ê°•ì œë¡œ ì¤‘ì§€í•©ë‹ˆë‹¤.\n\n# ì‘ì—…ì\n\n\u003cdiv class=\"content-ad\"\u003e\u003c/div\u003e\n\n**Worker êµ¬ì¡°ì²´ëŠ” ìš”ì²­ì„ ì²˜ë¦¬í•˜ëŠ” ì‘ì—…ìë¥¼ ë‚˜íƒ€ëƒ…ë‹ˆë‹¤. ê° ì‘ì—…ìëŠ” ìì‹ ë§Œì˜ ê³ ë£¨í‹´ì—ì„œ ì‹¤í–‰ë˜ë©° ì±„ë„ì—ì„œ ìˆ˜ì‹ ëœ ë“¤ì–´ì˜¤ëŠ” ìš”ì²­ì„ ì²­ì·¨í•©ë‹ˆë‹¤.**\n\n- **LaunchWorker**: ì‘ì—…ìë¥¼ ë³„ë„ì˜ ê³ ë£¨í‹´ìœ¼ë¡œ ì‹¤í–‰í•©ë‹ˆë‹¤. ì‘ì—…ìëŠ” ì…ë ¥ ì±„ë„ì´ ë‹«íˆê±°ë‚˜ ì •ì§€ ì‹ í˜¸ë¥¼ ë°›ì„ ë•Œê¹Œì§€ ë“¤ì–´ì˜¤ëŠ” ìš”ì²­ì„ ì²˜ë¦¬í•©ë‹ˆë‹¤.\n- **processRequest**: ê°œë³„ ìš”ì²­ì„ ì²˜ë¦¬í•©ë‹ˆë‹¤. ì—ëŸ¬ê°€ ë°œìƒí•˜ê±°ë‚˜ ìš”ì²­ ì‹œê°„ì´ ì´ˆê³¼ë˜ì—ˆì„ ê²½ìš° ìµœëŒ€ ì§€ì •ëœ ì¬ì‹œë„ íšŸìˆ˜ê¹Œì§€ ìš”ì²­ì„ ë‹¤ì‹œ ì‹œë„í•©ë‹ˆë‹¤.\n\n**ì½”ë“œ**\n\n```go\n// struct.go\n\npackage workerpool\n\nimport \"time\"\n\n// RequestëŠ” ì‘ì—…ìì— ì˜í•´ ì²˜ë¦¬ë  ìš”ì²­ì„ ë‚˜íƒ€ëƒ…ë‹ˆë‹¤.\ntype Request struct {\n    Handler    RequestHandler\n    Type       int\n    Data       interface{}\n    Timeout    time.Duration // ìš”ì²­ì˜ ì œí•œ ì‹œê°„\n    Retries    int           // ì¬ì‹œë„ íšŸìˆ˜\n    MaxRetries int           // ìµœëŒ€ ì¬ì‹œë„ íšŸìˆ˜\n}\n\n// RequestHandlerëŠ” ìš”ì²­ì„ ì²˜ë¦¬í•˜ëŠ” í•¨ìˆ˜ ìœ í˜•ì„ ì •ì˜í•©ë‹ˆë‹¤.\ntype RequestHandler func(interface{}) error\n```\n\n\u003cdiv class=\"content-ad\"\u003e\u003c/div\u003e\n\n\n### interface.go\n\n```go\npackage workerpool\n\nimport \"context\"\n\n// WorkerLauncherëŠ” ì›Œì»¤ë¥¼ ì‹¤í–‰í•˜ê¸° ìœ„í•œ ì¸í„°í˜ì´ìŠ¤ì…ë‹ˆë‹¤.\ntype WorkerLauncher interface {\n LaunchWorker(in chan Request, stopCh chan struct{})\n}\n\n// DispatcherëŠ” ì›Œì»¤ í’€ì„ ê´€ë¦¬í•˜ê¸° ìœ„í•œ ì¸í„°í˜ì´ìŠ¤ì…ë‹ˆë‹¤.\ntype Dispatcher interface {\n AddWorker(w WorkerLauncher)\n RemoveWorker(minWorkers int)\n LaunchWorker(id int, w WorkerLauncher)\n ScaleWorkers(minWorkers, maxWorkers, loadThreshold int)\n MakeRequest(Request)\n Stop(ctx context.Context)\n}\n```\n\n### worker.go\n\n```go\npackage workerpool\n\nimport (\n \"context\"\n \"fmt\"\n \"sync\"\n \"time\"\n)\n\n// WorkerëŠ” ìš”ì²­ì„ ì²˜ë¦¬í•˜ëŠ” ì›Œì»¤ë¥¼ ë‚˜íƒ€ëƒ…ë‹ˆë‹¤.\ntype Worker struct {\n Id         int\n Wg         *sync.WaitGroup\n ReqHandler map[int]RequestHandler\n}\n\n// LaunchWorkerëŠ” ì›Œì»¤ë¥¼ ì‹¤í–‰í•˜ì—¬ ë“¤ì–´ì˜¤ëŠ” ìš”ì²­ì„ ì²˜ë¦¬í•©ë‹ˆë‹¤.\n// ì´ëŠ” ë³„ë„ì˜ ê³ ë£¨í‹´ì—ì„œ ì‹¤í–‰ë˜ë©°, ì…ë ¥ ì±„ë„ì—ì„œ ë“¤ì–´ì˜¤ëŠ” ìš”ì²­ì„ ì§€ì†ì ìœ¼ë¡œ ìˆ˜ì‹ í•©ë‹ˆë‹¤.\n// ì›Œì»¤ëŠ” ì…ë ¥ ì±„ë„ì´ ë‹«íˆê±°ë‚˜ ì¤‘ì§€ ì‹ í˜¸ë¥¼ ë°›ìœ¼ë©´ ì •ìƒì ìœ¼ë¡œ ì¢…ë£Œë©ë‹ˆë‹¤.\nfunc (w *Worker) LaunchWorker(in chan Request, stopCh chan struct{}) {\n go func() {\n  defer w.Wg.Done()\n  for {\n   select {\n   case msg, open := \u003c-in:\n    if !open {\n     // ì±„ë„ì´ ë‹«íˆë©´ ì²˜ë¦¬ë¥¼ ì¤‘ì§€í•˜ê³  ë°˜í™˜í•©ë‹ˆë‹¤.\n     fmt.Println(\"ì›Œì»¤ ì¤‘ì§€:\", w.Id)\n     return\n    }\n    w.processRequest(msg)\n    time.Sleep(1 * time.Microsecond) // ë°€ë¦¬ì´ˆ ë‹¨ìœ„ì˜ ì‘ì€ ì§€ì—°\n   case \u003c-stopCh:\n    fmt.Println(\"ì›Œì»¤ ì¤‘ì§€:\", w.Id)\n    return\n   }\n  }\n }()\n}\n\n// processRequestëŠ” í•˜ë‚˜ì˜ ìš”ì²­ì„ ì²˜ë¦¬í•©ë‹ˆë‹¤.\nfunc (w *Worker) processRequest(msg Request) {\n fmt.Printf(\"ì›Œì»¤ %dê°€ ìš”ì²­ ì²˜ë¦¬ ì¤‘: %v\\n\", w.Id, msg)\n var handler RequestHandler\n var ok bool\n if handler, ok = w.ReqHandler[msg.Type]; !ok {\n  fmt.Println(\"í•¸ë“¤ëŸ¬ê°€ êµ¬í˜„ë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤: ì›Œì»¤ID:\", w.Id)\n } else {\n  if msg.Timeout == 0 {\n   msg.Timeout = time.Duration(10 * time.Millisecond) // ê¸°ë³¸ íƒ€ì„ì•„ì›ƒ\n  }\n  for attempt := 0; attempt \u003c= msg.MaxRetries; attempt++ {\n   var err error\n   done := make(chan struct{})\n   ctx, cancel := context.WithTimeout(context.Background(), msg.Timeout)\n   defer cancel()\n\n   go func() {\n    err = handler(msg.Data)\n    close(done)\n   }()\n\n   select {\n   case \u003c-done:\n    if err == nil {\n     return // ì„±ê³µì ìœ¼ë¡œ ì²˜ë¦¬\n    }\n    fmt.Printf(\"ì›Œì»¤ %d: ìš”ì²­ ì²˜ë¦¬ ì¤‘ ì˜¤ë¥˜: %v\\n\", w.Id, err)\n   case \u003c-ctx.Done():\n    fmt.Printf(\"ì›Œì»¤ %d: ìš”ì²­ ì²˜ë¦¬ ì‹œê°„ ì´ˆê³¼: %v\\n\", w.Id, msg.Data)\n   }\n   fmt.Printf(\"ì›Œì»¤ %d: ìš”ì²­ %vì— ëŒ€í•œ ì¬ì‹œë„ %d\\n\", w.Id, attempt, msg.Data)\n  }\n  fmt.Printf(\"ì›Œì»¤ %d: %dë²ˆ ì¬ì‹œë„ í›„ ìš”ì²­ %v ì²˜ë¦¬ ì‹¤íŒ¨\\n\", w.Id, msg.MaxRetries, msg.Data)\n }\n}\n```\n\n### dispatcher.go\n\n```go\npackage workerpool\n\nimport (\n \"context\"\n \"fmt\"\n \"sync\"\n \"time\"\n)\n\n// ReqHandlerëŠ” ìš”ì²­ íƒ€ì…ë³„ë¡œ ë§¤í•‘ëœ í•¸ë“¤ëŸ¬ ë§µì…ë‹ˆë‹¤.\nvar ReqHandler = map[int]RequestHandler{\n 1: func(data interface{}) error {\n  return nil\n },\n}\n\n// dispatcherëŠ” ì›Œì»¤ í’€ì„ ê´€ë¦¬í•˜ê³  ë“¤ì–´ì˜¤ëŠ” ìš”ì²­ì„ ì›Œì»¤ë“¤ ì‚¬ì´ì— ë¶„ë°°í•˜ëŠ” ì—­í• ì„ í•©ë‹ˆë‹¤.\ntype dispatcher struct {\n inCh        chan Request\n wg          *sync.WaitGroup\n mu          sync.Mutex\n workerCount int\n stopCh      chan struct{} // ì›Œì»¤ì— ì¤‘ì§€ ì‹ í˜¸ë¥¼ ë³´ë‚´ê¸° ìœ„í•œ ì±„ë„\n}\n\n// AddWorkerëŠ” ìƒˆë¡œìš´ ì›Œì»¤ë¥¼ í’€ì— ì¶”ê°€í•˜ê³  ì›Œì»¤ ìˆ˜ë¥¼ ì¦ê°€ì‹œí‚µë‹ˆë‹¤.\nfunc (d *dispatcher) AddWorker(w WorkerLauncher) {\n d.mu.Lock()\n defer d.mu.Unlock()\n d.workerCount++\n d.wg.Add(1)\n w.LaunchWorker(d.inCh, d.stopCh)\n}\n\n// RemoveWorkerëŠ” ì›Œì»¤ ìˆ˜ê°€ minWorkersë³´ë‹¤ í° ê²½ìš° ì›Œì»¤ë¥¼ í’€ì—ì„œ ì œê±°í•©ë‹ˆë‹¤.\nfunc (d *dispatcher) RemoveWorker(minWorkers int) {\n d.mu.Lock()\n defer d.mu.Unlock()\n if d.workerCount \u003e minWorkers {\n  d.workerCount--\n  d.stopCh \u003c- struct{}{} // ì›Œì»¤ì— ì¤‘ì§€ ì‹ í˜¸ ì „ì†¡\n }\n}\n\n// ScaleWorkersëŠ” í˜„ì¬ ë¶€í•˜ì— ë”°ë¼ ì›Œì»¤ ìˆ˜ë¥¼ ë™ì ìœ¼ë¡œ ì¡°ì •í•©ë‹ˆë‹¤.\nfunc (d *dispatcher) ScaleWorkers(minWorkers, maxWorkers, loadThreshold int) {\n ticker := time.NewTicker(time.Microsecond)\n defer ticker.Stop()\n\n for range ticker.C {\n  load := len(d.inCh) // í˜„ì¬ ë¶€í•˜ëŠ” ì±„ë„ì— ëŒ€ê¸° ì¤‘ì¸ ìš”ì²­ ìˆ˜\n  if load \u003e loadThreshold \u0026\u0026 d.workerCount \u003c maxWorkers {\n   fmt.Println(\"ìŠ¤ì¼€ì¼ë§ íŠ¸ë¦¬ê±°\")\n   newWorker := \u0026Worker{\n    Wg:         d.wg,\n    Id:         d.workerCount,\n    ReqHandler: ReqHandler,\n   }\n   d.AddWorker(newWorker)\n  } else if load \u003c 0.75*loadThreshold \u0026\u0026 d.workerCount \u003e minWorkers {\n   fmt.Println(\"ì¶•ì†Œ íŠ¸ë¦¬ê±°\")\n   d.RemoveWorker(minWorkers)\n  }\n }\n}\n\n// LaunchWorkerëŠ” ì›Œì»¤ë¥¼ ì‹œì‘í•˜ê³  ì›Œì»¤ ìˆ˜ë¥¼ ì¦ê°€ì‹œí‚µë‹ˆë‹¤.\nfunc (d *dispatcher) LaunchWorker(id int, w WorkerLauncher) {\n w.LaunchWorker(d.inCh, d.stopCh) // ì¤‘ì§€ ì±„ë„ì„ ì›Œì»¤ì— ì „ë‹¬\n d.mu.Lock()\n d.workerCount++\n d.mu.Unlock()\n}\n\n// MakeRequestëŠ” ìš”ì²­ì„ ì…ë ¥ ì±„ë„ì— ì¶”ê°€í•˜ê±°ë‚˜ ì±„ë„ì´ ê°€ë“ ì°¬ ê²½ìš° ì‚­ì œí•©ë‹ˆë‹¤.\nfunc (d *dispatcher) MakeRequest(r Request) {\n select {\n case d.inCh \u003c- r:\n default:\n  // ì±„ë„ì´ ê°€ë“ ì°¬ ê²½ìš° ì²˜ë¦¬\n  fmt.Println(\"ìš”ì²­ ì±„ë„ì´ ê°€ë“ ì°¼ìŠµë‹ˆë‹¤. ìš”ì²­ ì‚­ì œë¨.\")\n  // ë‹¤ë¥¸ ì¡°ì¹˜ë¥¼ ì·¨í•˜ê¸° ì „ì— ë¡œê¹…, ìš”ì²­ ë²„í¼ë§ ë˜ëŠ” ë‹¤ë¥¸ ì¡°ì¹˜ë¥¼ ì·¨í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.\n }\n}\n\n// StopëŠ” ëª¨ë“  ì›Œì»¤ë¥¼ ì •ìƒì ìœ¼ë¡œ ì¢…ë£Œí•˜ê³  ì²˜ë¦¬ê°€ ì™„ë£Œë  ë•Œê¹Œì§€ ê¸°ë‹¤ë¦½ë‹ˆë‹¤.\nfunc (d *dispatcher) Stop(ctx context.Context) {\n fmt.Println(\"\\nì¤‘ì§€ í˜¸ì¶œë¨\")\n close(d.inCh) // ë” ì´ìƒ ìš”ì²­ì„ ë³´ë‚´ì§€ ì•ŠìŒì„ ì•Œë¦¬ê¸° ìœ„í•´ ì…ë ¥ ì±„ë„ ë‹«ê¸°\n done := make(chan struct{})\n\n go func() {\n  d.wg.Wait() // ëª¨ë“  ì›Œì»¤ê°€ ì¢…ë£Œë  ë•Œê¹Œì§€ ëŒ€ê¸°\n  close(done)\n }()\n\n select {\n case \u003c-done:\n  fmt.Println(\"ëª¨ë“  ì›Œì»¤ê°€ ì •ìƒì ìœ¼ë¡œ ì¤‘ì§€ë¨\")\n case \u003c-ctx.Done():\n  fmt.Println(\"ì‹œê°„ ì´ˆê³¼, ê°•ì œ ì¢…ë£Œ\")\n  // ì‹œê°„ ì´ˆê³¼ ì‹œ ëª¨ë“  ì›Œì»¤ ê°•ì œ ì¢…ë£Œ\n  for i := 0; i \u003c d.workerCount; i++ {\n   d.stopCh \u003c- struct{}{}\n  }\n }\n\n d.wg.Wait()\n}\n\n// NewDispatcherëŠ” ë²„í¼ë§ëœ ì±„ë„ê³¼ ì›¨ì´íŠ¸ ê·¸ë£¹ì´ ìˆëŠ” ìƒˆë¡œìš´ ë””ìŠ¤íŒ¨ì²˜ë¥¼ ìƒì„±í•©ë‹ˆë‹¤.\nfunc NewDispatcher(b int, wg *sync.WaitGroup, maxWorkers int) Dispatcher {\n return \u0026dispatcher{\n  inCh:   make(chan Request, b),\n  wg:     wg,\n  stopCh: make(chan struct{}, maxWorkers), // ë¸”ë¡œí‚¹ì„ ë°©ì§€í•˜ê¸° ìœ„í•œ ë²„í¼ë§ëœ ì±„ë„\n }\n}\n```\n\n### main.go\n\n```go\npackage main\n\nimport (\n \"context\"\n \"fmt\"\n \"runtime\"\n \"sync\"\n \"time\"\n wp \"workerpool/workerpool\"\n)\n\n\n\n\u003cdiv class=\"content-ad\"\u003e\u003c/div\u003e\n\n# ë©”ì¸\n\nì£¼ìš” ê¸°ëŠ¥ì€ ë””ìŠ¤íŒ¨ì²˜ì™€ ì›Œì»¤ë¥¼ ì´ˆê¸°í™”í•˜ê³  ì‘ì—…ì„ ë³´ë‚´ë©°, ë””ìŠ¤íŒ¨ì²˜ë¥¼ ì›í™œí•˜ê²Œ ì¢…ë£Œí•©ë‹ˆë‹¤.\n\n- GOMAXPROCSë¥¼ ì‚¬ìš© ê°€ëŠ¥í•œ CPU ìˆ˜ë¡œ ì„¤ì •í•©ë‹ˆë‹¤.\n- ë””ìŠ¤íŒ¨ì²˜ë¥¼ ì´ˆê¸°í™”í•˜ê³  ì´ˆê¸° ì›Œì»¤ ì§‘í•©ì„ ì‹œì‘í•©ë‹ˆë‹¤.\n- ë””ìŠ¤íŒ¨ì²˜ì— ìš”ì²­ì„ ë³´ëƒ…ë‹ˆë‹¤.\n- íƒ€ì„ì•„ì›ƒì„ ì„¤ì •í•˜ì—¬ ë””ìŠ¤íŒ¨ì²˜ë¥¼ ì›í™œí•˜ê²Œ ì¢…ë£Œí•©ë‹ˆë‹¤.\n\nìš°ë¦¬ëŠ” ì»¨í…ìŠ¤íŠ¸ íƒ€ì„ì•„ì›ƒ, ë²„í¼ í¬ê¸°, ìµœì†Œ/ìµœëŒ€ ì›Œì»¤ì™€ ê°™ì€ ë§¤ê°œë³€ìˆ˜ë¥¼ ì¡°ì •í•˜ì—¬ ì´ˆë‹¹ ìš”ì²­(RPS)ì„ ìµœëŒ€í™”í•˜ê³  ì• í”Œë¦¬ì¼€ì´ì…˜ ì„±ëŠ¥ì„ í–¥ìƒì‹œí‚¬ ê²ƒì…ë‹ˆë‹¤.\n\n\u003cdiv class=\"content-ad\"\u003e\u003c/div\u003e\n\nStay tuned for practical insights and real-world examples!\n\nIf you've read up till now, I hope you enjoyed this article. If you did, please show your support by giving it a clap, as it helps me stay motivated to assist the community.\n\nFeel free to leave a comment if you noticed any discrepancies in this article or if you have any questions related to the content.\n\nThank you for your time.\n\n\u003cdiv class=\"content-ad\"\u003e\u003c/div\u003e\n\në§ˆìŒì— ë“œì‹œëŠ” ì‚¬ëŒë“¤ê³¼ ì–¸ì œë“  ì—°ë½í•˜ì„¸ìš”! LinkedInì— ì—°ê²°í•´ë³´ëŠ” ê±´ ì–´ë– ì„¸ìš”? ğŸ¤\n```\n","ogImage":{"url":"/assets/img/2024-05-27-MasteringConcurrentProcessingAStep-by-StepGuidetoBuildingaScalableWorkerPoolinGo_0.png"},"coverImage":"/assets/img/2024-05-27-MasteringConcurrentProcessingAStep-by-StepGuidetoBuildingaScalableWorkerPoolinGo_0.png","tag":["Tech"],"readingTime":8},"content":"\u003c!doctype html\u003e\n\u003chtml lang=\"en\"\u003e\n\u003chead\u003e\n\u003cmeta charset=\"utf-8\"\u003e\n\u003cmeta content=\"width=device-width, initial-scale=1\" name=\"viewport\"\u003e\n\u003c/head\u003e\n\u003cbody\u003e\n\u003cp\u003e\u003cstrong\u003e10,000ê°œì˜ ìš”ì²­ì„ ì´ˆë‹¹ ì²˜ë¦¬í•´ìš”!\u003c/strong\u003e\u003c/p\u003e\n\u003cp\u003eğŸ¤ LinkedInì—ì„œ ì €ì™€ ì—°ê²°í•´ìš”. í™•ì¥ ê°€ëŠ¥í•œ ì‹œìŠ¤í…œì„ ë§Œë“¤ì–´ë´ìš”.\u003c/p\u003e\n\u003cp\u003eì´ ë¸”ë¡œê·¸ í¬ìŠ¤íŠ¸ì—ì„œëŠ” Goë¥¼ ì‚¬ìš©í•˜ì—¬ í™•ì¥ ê°€ëŠ¥í•œ ì›Œì»¤ í’€ì„ êµ¬ì¶•í•´ë³¼ ê±°ì—ìš”. ì´ êµ¬í˜„ì€ ìš”ì²­ì˜ ëŒ€ëŸ‰ì„ ì²˜ë¦¬í•˜ê¸° ìœ„í•´ ì›Œì»¤ í’€ì„ íš¨ìœ¨ì ìœ¼ë¡œ ê´€ë¦¬í•˜ë©°, ë¶€í•˜ì— ë”°ë¼ ì›Œì»¤ ìˆ˜ë¥¼ ë™ì ìœ¼ë¡œ í™•ì¥í•©ë‹ˆë‹¤. ì ì¬ì ì¸ í•¨ì •ì— ëŒ€í•´ ë…¼í•˜ê³ , ê·¸ê²ƒë“¤ì„ í”¼í•˜ëŠ” ë°©ë²•ì— ëŒ€í•´ ì•Œì•„ë³¼ ê±°ì—ìš”.\u003c/p\u003e\n\u003ch1\u003eê°œìš”\u003c/h1\u003e\n\u003cdiv class=\"content-ad\"\u003e\u003c/div\u003e\n\u003cp\u003eìš°ë¦¬ëŠ” ë‹¤ìŒê³¼ ê°™ì€ ê¸°ëŠ¥ì„ ê°–ì¶˜ ì‘ì—…ì í’€ì„ ìƒì„±í•  ê²ƒì…ë‹ˆë‹¤:\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003eë¶€í•˜ì— ë”°ë¼ ì‘ì—…ì ìˆ˜ë¥¼ ë™ì ìœ¼ë¡œ ì¡°ì ˆí•©ë‹ˆë‹¤.\u003c/li\u003e\n\u003cli\u003eìš”ì²­ì„ íƒ€ì„ì•„ì›ƒ ë° ì¬ì‹œë„ ë©”ì»¤ë‹ˆì¦˜ìœ¼ë¡œ ì²˜ë¦¬í•©ë‹ˆë‹¤.\u003c/li\u003e\n\u003cli\u003eì‘ì—…ìë¥¼ ìš°ì•„í•˜ê²Œ ì¢…ë£Œí•©ë‹ˆë‹¤.\u003c/li\u003e\n\u003c/ul\u003e\n\u003cp\u003eë‹¤ìŒì€ ì™„ì „í•œ ì½”ë“œì™€ ê° ë¶€ë¶„ì— ëŒ€í•œ ì„¤ëª… ë° ë¬¸ì„œí™”ê°€ ì œê³µë©ë‹ˆë‹¤.\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"/assets/img/2024-05-27-MasteringConcurrentProcessingAStep-by-StepGuidetoBuildingaScalableWorkerPoolinGo_0.png\" alt=\"Mastering Concurrent Processing: A Step-by-Step Guide to Building a Scalable Worker Pool in Go\"\u003e\u003c/p\u003e\n\u003cdiv class=\"content-ad\"\u003e\u003c/div\u003e\n\u003ch1\u003eë””ìŠ¤íŒ¨ì²˜\u003c/h1\u003e\n\u003cp\u003eë””ìŠ¤íŒ¨ì²˜ëŠ” ì‘ì—…ìë¥¼ ê´€ë¦¬í•˜ê³  ë“¤ì–´ì˜¤ëŠ” ìš”ì²­ì„ ë¶„ë°°í•˜ëŠ” ì—­í• ì„ í•©ë‹ˆë‹¤. í˜„ì¬ ë¶€í•˜ì— ë”°ë¼ ë™ì ìœ¼ë¡œ ì‘ì—…ìë¥¼ ì¶”ê°€í•˜ê±°ë‚˜ ì œê±°í•˜ë©° ëª¨ë“  ì‘ì—…ìë“¤ì„ ì›í™œí•˜ê²Œ ì¢…ë£Œí•©ë‹ˆë‹¤.\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003eAddWorker: í’€ì— ìƒˆ ì‘ì—…ìë¥¼ ì¶”ê°€í•˜ê³  ì‘ì—…ì ìˆ˜ë¥¼ ì¦ê°€ì‹œí‚µë‹ˆë‹¤. ì‘ì—…ìëŠ” ìš”ì²­ ì²˜ë¦¬ë¥¼ ì‹œì‘í•˜ê¸° ìœ„í•´ ì‹¤í–‰ë©ë‹ˆë‹¤.\u003c/li\u003e\n\u003cli\u003eRemoveWorker: ìµœì†Œ í•„ìš”í•œ ì‘ì—…ìë³´ë‹¤ ë§ì€ ê²½ìš° í’€ì—ì„œ ì‘ì—…ìë¥¼ ì œê±°í•©ë‹ˆë‹¤. ì‘ì—…ìëŠ” stopCh ì±„ë„ì„ í†µí•´ ì¤‘ì§€ë˜ë„ë¡ ì‹ í˜¸ë¥¼ ë³´ëƒ…ë‹ˆë‹¤.\u003c/li\u003e\n\u003cli\u003eScaleWorkers: ë¶€í•˜ì— ë”°ë¼ ì‘ì—…ì ìˆ˜ë¥¼ ë™ì ìœ¼ë¡œ ì¡°ì •í•©ë‹ˆë‹¤. ë¶€í•˜ê°€ ì„ê³„ê°’ì„ ì´ˆê³¼í•˜ê³  ìµœëŒ€ í—ˆìš© ì‘ì—…ìë³´ë‹¤ ì‘ì€ ê²½ìš° ìƒˆ ì‘ì—…ìê°€ ì¶”ê°€ë©ë‹ˆë‹¤. ë¶€í•˜ê°€ ì„ê³„ê°’ ì•„ë˜ì´ê³  ìµœì†Œ í•„ìš”í•œ ì‘ì—…ìë³´ë‹¤ ë§ì€ ê²½ìš° ì‘ì—…ìê°€ ì œê±°ë©ë‹ˆë‹¤.\u003c/li\u003e\n\u003cli\u003eLaunchWorker: ì‘ì—…ìë¥¼ ì‹œì‘í•˜ê³  ì‘ì—…ì ìˆ˜ë¥¼ ì¦ê°€ì‹œí‚µë‹ˆë‹¤. ì¼ë°˜ì ìœ¼ë¡œ ì´ˆê¸° ì‘ì—…ì ì„¸íŠ¸ì— ì‚¬ìš©ë©ë‹ˆë‹¤.\u003c/li\u003e\n\u003cli\u003eMakeRequest: ì…ë ¥ ì±„ë„ì— ìš”ì²­ì„ ì¶”ê°€í•©ë‹ˆë‹¤. ì±„ë„ì´ ê°€ë“ ì°¬ ê²½ìš° ìš”ì²­ì€ ì‚­ì œë˜ê³  ë©”ì‹œì§€ê°€ ê¸°ë¡ë©ë‹ˆë‹¤.\u003c/li\u003e\n\u003cli\u003eStop: ëª¨ë“  ì‘ì—…ìë¥¼ ì›í™œí•˜ê²Œ ì¤‘ì§€í•©ë‹ˆë‹¤. ëª¨ë“  ì‘ì—…ìê°€ í˜„ì¬ ìš”ì²­ ì²˜ë¦¬ë¥¼ ì™„ë£Œí•  ë•Œê¹Œì§€ ê¸°ë‹¤ë¦½ë‹ˆë‹¤. ì œí•œ ì‹œê°„ì— ë„ë‹¬í•˜ë©´ ëª¨ë“  ì‘ì—…ìë¥¼ ê°•ì œë¡œ ì¤‘ì§€í•©ë‹ˆë‹¤.\u003c/li\u003e\n\u003c/ul\u003e\n\u003ch1\u003eì‘ì—…ì\u003c/h1\u003e\n\u003cdiv class=\"content-ad\"\u003e\u003c/div\u003e\n\u003cp\u003e\u003cstrong\u003eWorker êµ¬ì¡°ì²´ëŠ” ìš”ì²­ì„ ì²˜ë¦¬í•˜ëŠ” ì‘ì—…ìë¥¼ ë‚˜íƒ€ëƒ…ë‹ˆë‹¤. ê° ì‘ì—…ìëŠ” ìì‹ ë§Œì˜ ê³ ë£¨í‹´ì—ì„œ ì‹¤í–‰ë˜ë©° ì±„ë„ì—ì„œ ìˆ˜ì‹ ëœ ë“¤ì–´ì˜¤ëŠ” ìš”ì²­ì„ ì²­ì·¨í•©ë‹ˆë‹¤.\u003c/strong\u003e\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003e\u003cstrong\u003eLaunchWorker\u003c/strong\u003e: ì‘ì—…ìë¥¼ ë³„ë„ì˜ ê³ ë£¨í‹´ìœ¼ë¡œ ì‹¤í–‰í•©ë‹ˆë‹¤. ì‘ì—…ìëŠ” ì…ë ¥ ì±„ë„ì´ ë‹«íˆê±°ë‚˜ ì •ì§€ ì‹ í˜¸ë¥¼ ë°›ì„ ë•Œê¹Œì§€ ë“¤ì–´ì˜¤ëŠ” ìš”ì²­ì„ ì²˜ë¦¬í•©ë‹ˆë‹¤.\u003c/li\u003e\n\u003cli\u003e\u003cstrong\u003eprocessRequest\u003c/strong\u003e: ê°œë³„ ìš”ì²­ì„ ì²˜ë¦¬í•©ë‹ˆë‹¤. ì—ëŸ¬ê°€ ë°œìƒí•˜ê±°ë‚˜ ìš”ì²­ ì‹œê°„ì´ ì´ˆê³¼ë˜ì—ˆì„ ê²½ìš° ìµœëŒ€ ì§€ì •ëœ ì¬ì‹œë„ íšŸìˆ˜ê¹Œì§€ ìš”ì²­ì„ ë‹¤ì‹œ ì‹œë„í•©ë‹ˆë‹¤.\u003c/li\u003e\n\u003c/ul\u003e\n\u003cp\u003e\u003cstrong\u003eì½”ë“œ\u003c/strong\u003e\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-go\"\u003e\u003cspan class=\"hljs-comment\"\u003e// struct.go\u003c/span\u003e\n\n\u003cspan class=\"hljs-keyword\"\u003epackage\u003c/span\u003e workerpool\n\n\u003cspan class=\"hljs-keyword\"\u003eimport\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003e\"time\"\u003c/span\u003e\n\n\u003cspan class=\"hljs-comment\"\u003e// RequestëŠ” ì‘ì—…ìì— ì˜í•´ ì²˜ë¦¬ë  ìš”ì²­ì„ ë‚˜íƒ€ëƒ…ë‹ˆë‹¤.\u003c/span\u003e\n\u003cspan class=\"hljs-keyword\"\u003etype\u003c/span\u003e Request \u003cspan class=\"hljs-keyword\"\u003estruct\u003c/span\u003e {\n    Handler    RequestHandler\n    Type       \u003cspan class=\"hljs-type\"\u003eint\u003c/span\u003e\n    Data       \u003cspan class=\"hljs-keyword\"\u003einterface\u003c/span\u003e{}\n    Timeout    time.Duration \u003cspan class=\"hljs-comment\"\u003e// ìš”ì²­ì˜ ì œí•œ ì‹œê°„\u003c/span\u003e\n    Retries    \u003cspan class=\"hljs-type\"\u003eint\u003c/span\u003e           \u003cspan class=\"hljs-comment\"\u003e// ì¬ì‹œë„ íšŸìˆ˜\u003c/span\u003e\n    MaxRetries \u003cspan class=\"hljs-type\"\u003eint\u003c/span\u003e           \u003cspan class=\"hljs-comment\"\u003e// ìµœëŒ€ ì¬ì‹œë„ íšŸìˆ˜\u003c/span\u003e\n}\n\n\u003cspan class=\"hljs-comment\"\u003e// RequestHandlerëŠ” ìš”ì²­ì„ ì²˜ë¦¬í•˜ëŠ” í•¨ìˆ˜ ìœ í˜•ì„ ì •ì˜í•©ë‹ˆë‹¤.\u003c/span\u003e\n\u003cspan class=\"hljs-keyword\"\u003etype\u003c/span\u003e RequestHandler \u003cspan class=\"hljs-function\"\u003e\u003cspan class=\"hljs-keyword\"\u003efunc\u003c/span\u003e\u003cspan class=\"hljs-params\"\u003e(\u003cspan class=\"hljs-keyword\"\u003einterface\u003c/span\u003e{})\u003c/span\u003e\u003c/span\u003e \u003cspan class=\"hljs-type\"\u003eerror\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\n\u003cdiv class=\"content-ad\"\u003e\u003c/div\u003e\n\u003ch3\u003einterface.go\u003c/h3\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-go\"\u003e\u003cspan class=\"hljs-keyword\"\u003epackage\u003c/span\u003e workerpool\n\n\u003cspan class=\"hljs-keyword\"\u003eimport\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003e\"context\"\u003c/span\u003e\n\n\u003cspan class=\"hljs-comment\"\u003e// WorkerLauncherëŠ” ì›Œì»¤ë¥¼ ì‹¤í–‰í•˜ê¸° ìœ„í•œ ì¸í„°í˜ì´ìŠ¤ì…ë‹ˆë‹¤.\u003c/span\u003e\n\u003cspan class=\"hljs-keyword\"\u003etype\u003c/span\u003e WorkerLauncher \u003cspan class=\"hljs-keyword\"\u003einterface\u003c/span\u003e {\n LaunchWorker(in \u003cspan class=\"hljs-keyword\"\u003echan\u003c/span\u003e Request, stopCh \u003cspan class=\"hljs-keyword\"\u003echan\u003c/span\u003e \u003cspan class=\"hljs-keyword\"\u003estruct\u003c/span\u003e{})\n}\n\n\u003cspan class=\"hljs-comment\"\u003e// DispatcherëŠ” ì›Œì»¤ í’€ì„ ê´€ë¦¬í•˜ê¸° ìœ„í•œ ì¸í„°í˜ì´ìŠ¤ì…ë‹ˆë‹¤.\u003c/span\u003e\n\u003cspan class=\"hljs-keyword\"\u003etype\u003c/span\u003e Dispatcher \u003cspan class=\"hljs-keyword\"\u003einterface\u003c/span\u003e {\n AddWorker(w WorkerLauncher)\n RemoveWorker(minWorkers \u003cspan class=\"hljs-type\"\u003eint\u003c/span\u003e)\n LaunchWorker(id \u003cspan class=\"hljs-type\"\u003eint\u003c/span\u003e, w WorkerLauncher)\n ScaleWorkers(minWorkers, maxWorkers, loadThreshold \u003cspan class=\"hljs-type\"\u003eint\u003c/span\u003e)\n MakeRequest(Request)\n Stop(ctx context.Context)\n}\n\u003c/code\u003e\u003c/pre\u003e\n\u003ch3\u003eworker.go\u003c/h3\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-go\"\u003e\u003cspan class=\"hljs-keyword\"\u003epackage\u003c/span\u003e workerpool\n\n\u003cspan class=\"hljs-keyword\"\u003eimport\u003c/span\u003e (\n \u003cspan class=\"hljs-string\"\u003e\"context\"\u003c/span\u003e\n \u003cspan class=\"hljs-string\"\u003e\"fmt\"\u003c/span\u003e\n \u003cspan class=\"hljs-string\"\u003e\"sync\"\u003c/span\u003e\n \u003cspan class=\"hljs-string\"\u003e\"time\"\u003c/span\u003e\n)\n\n\u003cspan class=\"hljs-comment\"\u003e// WorkerëŠ” ìš”ì²­ì„ ì²˜ë¦¬í•˜ëŠ” ì›Œì»¤ë¥¼ ë‚˜íƒ€ëƒ…ë‹ˆë‹¤.\u003c/span\u003e\n\u003cspan class=\"hljs-keyword\"\u003etype\u003c/span\u003e Worker \u003cspan class=\"hljs-keyword\"\u003estruct\u003c/span\u003e {\n Id         \u003cspan class=\"hljs-type\"\u003eint\u003c/span\u003e\n Wg         *sync.WaitGroup\n ReqHandler \u003cspan class=\"hljs-keyword\"\u003emap\u003c/span\u003e[\u003cspan class=\"hljs-type\"\u003eint\u003c/span\u003e]RequestHandler\n}\n\n\u003cspan class=\"hljs-comment\"\u003e// LaunchWorkerëŠ” ì›Œì»¤ë¥¼ ì‹¤í–‰í•˜ì—¬ ë“¤ì–´ì˜¤ëŠ” ìš”ì²­ì„ ì²˜ë¦¬í•©ë‹ˆë‹¤.\u003c/span\u003e\n\u003cspan class=\"hljs-comment\"\u003e// ì´ëŠ” ë³„ë„ì˜ ê³ ë£¨í‹´ì—ì„œ ì‹¤í–‰ë˜ë©°, ì…ë ¥ ì±„ë„ì—ì„œ ë“¤ì–´ì˜¤ëŠ” ìš”ì²­ì„ ì§€ì†ì ìœ¼ë¡œ ìˆ˜ì‹ í•©ë‹ˆë‹¤.\u003c/span\u003e\n\u003cspan class=\"hljs-comment\"\u003e// ì›Œì»¤ëŠ” ì…ë ¥ ì±„ë„ì´ ë‹«íˆê±°ë‚˜ ì¤‘ì§€ ì‹ í˜¸ë¥¼ ë°›ìœ¼ë©´ ì •ìƒì ìœ¼ë¡œ ì¢…ë£Œë©ë‹ˆë‹¤.\u003c/span\u003e\n\u003cspan class=\"hljs-function\"\u003e\u003cspan class=\"hljs-keyword\"\u003efunc\u003c/span\u003e \u003cspan class=\"hljs-params\"\u003e(w *Worker)\u003c/span\u003e\u003c/span\u003e LaunchWorker(in \u003cspan class=\"hljs-keyword\"\u003echan\u003c/span\u003e Request, stopCh \u003cspan class=\"hljs-keyword\"\u003echan\u003c/span\u003e \u003cspan class=\"hljs-keyword\"\u003estruct\u003c/span\u003e{}) {\n \u003cspan class=\"hljs-keyword\"\u003ego\u003c/span\u003e \u003cspan class=\"hljs-function\"\u003e\u003cspan class=\"hljs-keyword\"\u003efunc\u003c/span\u003e\u003cspan class=\"hljs-params\"\u003e()\u003c/span\u003e\u003c/span\u003e {\n  \u003cspan class=\"hljs-keyword\"\u003edefer\u003c/span\u003e w.Wg.Done()\n  \u003cspan class=\"hljs-keyword\"\u003efor\u003c/span\u003e {\n   \u003cspan class=\"hljs-keyword\"\u003eselect\u003c/span\u003e {\n   \u003cspan class=\"hljs-keyword\"\u003ecase\u003c/span\u003e msg, open := \u0026#x3C;-in:\n    \u003cspan class=\"hljs-keyword\"\u003eif\u003c/span\u003e !open {\n     \u003cspan class=\"hljs-comment\"\u003e// ì±„ë„ì´ ë‹«íˆë©´ ì²˜ë¦¬ë¥¼ ì¤‘ì§€í•˜ê³  ë°˜í™˜í•©ë‹ˆë‹¤.\u003c/span\u003e\n     fmt.Println(\u003cspan class=\"hljs-string\"\u003e\"ì›Œì»¤ ì¤‘ì§€:\"\u003c/span\u003e, w.Id)\n     \u003cspan class=\"hljs-keyword\"\u003ereturn\u003c/span\u003e\n    }\n    w.processRequest(msg)\n    time.Sleep(\u003cspan class=\"hljs-number\"\u003e1\u003c/span\u003e * time.Microsecond) \u003cspan class=\"hljs-comment\"\u003e// ë°€ë¦¬ì´ˆ ë‹¨ìœ„ì˜ ì‘ì€ ì§€ì—°\u003c/span\u003e\n   \u003cspan class=\"hljs-keyword\"\u003ecase\u003c/span\u003e \u0026#x3C;-stopCh:\n    fmt.Println(\u003cspan class=\"hljs-string\"\u003e\"ì›Œì»¤ ì¤‘ì§€:\"\u003c/span\u003e, w.Id)\n    \u003cspan class=\"hljs-keyword\"\u003ereturn\u003c/span\u003e\n   }\n  }\n }()\n}\n\n\u003cspan class=\"hljs-comment\"\u003e// processRequestëŠ” í•˜ë‚˜ì˜ ìš”ì²­ì„ ì²˜ë¦¬í•©ë‹ˆë‹¤.\u003c/span\u003e\n\u003cspan class=\"hljs-function\"\u003e\u003cspan class=\"hljs-keyword\"\u003efunc\u003c/span\u003e \u003cspan class=\"hljs-params\"\u003e(w *Worker)\u003c/span\u003e\u003c/span\u003e processRequest(msg Request) {\n fmt.Printf(\u003cspan class=\"hljs-string\"\u003e\"ì›Œì»¤ %dê°€ ìš”ì²­ ì²˜ë¦¬ ì¤‘: %v\\n\"\u003c/span\u003e, w.Id, msg)\n \u003cspan class=\"hljs-keyword\"\u003evar\u003c/span\u003e handler RequestHandler\n \u003cspan class=\"hljs-keyword\"\u003evar\u003c/span\u003e ok \u003cspan class=\"hljs-type\"\u003ebool\u003c/span\u003e\n \u003cspan class=\"hljs-keyword\"\u003eif\u003c/span\u003e handler, ok = w.ReqHandler[msg.Type]; !ok {\n  fmt.Println(\u003cspan class=\"hljs-string\"\u003e\"í•¸ë“¤ëŸ¬ê°€ êµ¬í˜„ë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤: ì›Œì»¤ID:\"\u003c/span\u003e, w.Id)\n } \u003cspan class=\"hljs-keyword\"\u003eelse\u003c/span\u003e {\n  \u003cspan class=\"hljs-keyword\"\u003eif\u003c/span\u003e msg.Timeout == \u003cspan class=\"hljs-number\"\u003e0\u003c/span\u003e {\n   msg.Timeout = time.Duration(\u003cspan class=\"hljs-number\"\u003e10\u003c/span\u003e * time.Millisecond) \u003cspan class=\"hljs-comment\"\u003e// ê¸°ë³¸ íƒ€ì„ì•„ì›ƒ\u003c/span\u003e\n  }\n  \u003cspan class=\"hljs-keyword\"\u003efor\u003c/span\u003e attempt := \u003cspan class=\"hljs-number\"\u003e0\u003c/span\u003e; attempt \u0026#x3C;= msg.MaxRetries; attempt++ {\n   \u003cspan class=\"hljs-keyword\"\u003evar\u003c/span\u003e err \u003cspan class=\"hljs-type\"\u003eerror\u003c/span\u003e\n   done := \u003cspan class=\"hljs-built_in\"\u003emake\u003c/span\u003e(\u003cspan class=\"hljs-keyword\"\u003echan\u003c/span\u003e \u003cspan class=\"hljs-keyword\"\u003estruct\u003c/span\u003e{})\n   ctx, cancel := context.WithTimeout(context.Background(), msg.Timeout)\n   \u003cspan class=\"hljs-keyword\"\u003edefer\u003c/span\u003e cancel()\n\n   \u003cspan class=\"hljs-keyword\"\u003ego\u003c/span\u003e \u003cspan class=\"hljs-function\"\u003e\u003cspan class=\"hljs-keyword\"\u003efunc\u003c/span\u003e\u003cspan class=\"hljs-params\"\u003e()\u003c/span\u003e\u003c/span\u003e {\n    err = handler(msg.Data)\n    \u003cspan class=\"hljs-built_in\"\u003eclose\u003c/span\u003e(done)\n   }()\n\n   \u003cspan class=\"hljs-keyword\"\u003eselect\u003c/span\u003e {\n   \u003cspan class=\"hljs-keyword\"\u003ecase\u003c/span\u003e \u0026#x3C;-done:\n    \u003cspan class=\"hljs-keyword\"\u003eif\u003c/span\u003e err == \u003cspan class=\"hljs-literal\"\u003enil\u003c/span\u003e {\n     \u003cspan class=\"hljs-keyword\"\u003ereturn\u003c/span\u003e \u003cspan class=\"hljs-comment\"\u003e// ì„±ê³µì ìœ¼ë¡œ ì²˜ë¦¬\u003c/span\u003e\n    }\n    fmt.Printf(\u003cspan class=\"hljs-string\"\u003e\"ì›Œì»¤ %d: ìš”ì²­ ì²˜ë¦¬ ì¤‘ ì˜¤ë¥˜: %v\\n\"\u003c/span\u003e, w.Id, err)\n   \u003cspan class=\"hljs-keyword\"\u003ecase\u003c/span\u003e \u0026#x3C;-ctx.Done():\n    fmt.Printf(\u003cspan class=\"hljs-string\"\u003e\"ì›Œì»¤ %d: ìš”ì²­ ì²˜ë¦¬ ì‹œê°„ ì´ˆê³¼: %v\\n\"\u003c/span\u003e, w.Id, msg.Data)\n   }\n   fmt.Printf(\u003cspan class=\"hljs-string\"\u003e\"ì›Œì»¤ %d: ìš”ì²­ %vì— ëŒ€í•œ ì¬ì‹œë„ %d\\n\"\u003c/span\u003e, w.Id, attempt, msg.Data)\n  }\n  fmt.Printf(\u003cspan class=\"hljs-string\"\u003e\"ì›Œì»¤ %d: %dë²ˆ ì¬ì‹œë„ í›„ ìš”ì²­ %v ì²˜ë¦¬ ì‹¤íŒ¨\\n\"\u003c/span\u003e, w.Id, msg.MaxRetries, msg.Data)\n }\n}\n\u003c/code\u003e\u003c/pre\u003e\n\u003ch3\u003edispatcher.go\u003c/h3\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-go\"\u003e\u003cspan class=\"hljs-keyword\"\u003epackage\u003c/span\u003e workerpool\n\n\u003cspan class=\"hljs-keyword\"\u003eimport\u003c/span\u003e (\n \u003cspan class=\"hljs-string\"\u003e\"context\"\u003c/span\u003e\n \u003cspan class=\"hljs-string\"\u003e\"fmt\"\u003c/span\u003e\n \u003cspan class=\"hljs-string\"\u003e\"sync\"\u003c/span\u003e\n \u003cspan class=\"hljs-string\"\u003e\"time\"\u003c/span\u003e\n)\n\n\u003cspan class=\"hljs-comment\"\u003e// ReqHandlerëŠ” ìš”ì²­ íƒ€ì…ë³„ë¡œ ë§¤í•‘ëœ í•¸ë“¤ëŸ¬ ë§µì…ë‹ˆë‹¤.\u003c/span\u003e\n\u003cspan class=\"hljs-keyword\"\u003evar\u003c/span\u003e ReqHandler = \u003cspan class=\"hljs-keyword\"\u003emap\u003c/span\u003e[\u003cspan class=\"hljs-type\"\u003eint\u003c/span\u003e]RequestHandler{\n \u003cspan class=\"hljs-number\"\u003e1\u003c/span\u003e: \u003cspan class=\"hljs-function\"\u003e\u003cspan class=\"hljs-keyword\"\u003efunc\u003c/span\u003e\u003cspan class=\"hljs-params\"\u003e(data \u003cspan class=\"hljs-keyword\"\u003einterface\u003c/span\u003e{})\u003c/span\u003e\u003c/span\u003e \u003cspan class=\"hljs-type\"\u003eerror\u003c/span\u003e {\n  \u003cspan class=\"hljs-keyword\"\u003ereturn\u003c/span\u003e \u003cspan class=\"hljs-literal\"\u003enil\u003c/span\u003e\n },\n}\n\n\u003cspan class=\"hljs-comment\"\u003e// dispatcherëŠ” ì›Œì»¤ í’€ì„ ê´€ë¦¬í•˜ê³  ë“¤ì–´ì˜¤ëŠ” ìš”ì²­ì„ ì›Œì»¤ë“¤ ì‚¬ì´ì— ë¶„ë°°í•˜ëŠ” ì—­í• ì„ í•©ë‹ˆë‹¤.\u003c/span\u003e\n\u003cspan class=\"hljs-keyword\"\u003etype\u003c/span\u003e dispatcher \u003cspan class=\"hljs-keyword\"\u003estruct\u003c/span\u003e {\n inCh        \u003cspan class=\"hljs-keyword\"\u003echan\u003c/span\u003e Request\n wg          *sync.WaitGroup\n mu          sync.Mutex\n workerCount \u003cspan class=\"hljs-type\"\u003eint\u003c/span\u003e\n stopCh      \u003cspan class=\"hljs-keyword\"\u003echan\u003c/span\u003e \u003cspan class=\"hljs-keyword\"\u003estruct\u003c/span\u003e{} \u003cspan class=\"hljs-comment\"\u003e// ì›Œì»¤ì— ì¤‘ì§€ ì‹ í˜¸ë¥¼ ë³´ë‚´ê¸° ìœ„í•œ ì±„ë„\u003c/span\u003e\n}\n\n\u003cspan class=\"hljs-comment\"\u003e// AddWorkerëŠ” ìƒˆë¡œìš´ ì›Œì»¤ë¥¼ í’€ì— ì¶”ê°€í•˜ê³  ì›Œì»¤ ìˆ˜ë¥¼ ì¦ê°€ì‹œí‚µë‹ˆë‹¤.\u003c/span\u003e\n\u003cspan class=\"hljs-function\"\u003e\u003cspan class=\"hljs-keyword\"\u003efunc\u003c/span\u003e \u003cspan class=\"hljs-params\"\u003e(d *dispatcher)\u003c/span\u003e\u003c/span\u003e AddWorker(w WorkerLauncher) {\n d.mu.Lock()\n \u003cspan class=\"hljs-keyword\"\u003edefer\u003c/span\u003e d.mu.Unlock()\n d.workerCount++\n d.wg.Add(\u003cspan class=\"hljs-number\"\u003e1\u003c/span\u003e)\n w.LaunchWorker(d.inCh, d.stopCh)\n}\n\n\u003cspan class=\"hljs-comment\"\u003e// RemoveWorkerëŠ” ì›Œì»¤ ìˆ˜ê°€ minWorkersë³´ë‹¤ í° ê²½ìš° ì›Œì»¤ë¥¼ í’€ì—ì„œ ì œê±°í•©ë‹ˆë‹¤.\u003c/span\u003e\n\u003cspan class=\"hljs-function\"\u003e\u003cspan class=\"hljs-keyword\"\u003efunc\u003c/span\u003e \u003cspan class=\"hljs-params\"\u003e(d *dispatcher)\u003c/span\u003e\u003c/span\u003e RemoveWorker(minWorkers \u003cspan class=\"hljs-type\"\u003eint\u003c/span\u003e) {\n d.mu.Lock()\n \u003cspan class=\"hljs-keyword\"\u003edefer\u003c/span\u003e d.mu.Unlock()\n \u003cspan class=\"hljs-keyword\"\u003eif\u003c/span\u003e d.workerCount \u003e minWorkers {\n  d.workerCount--\n  d.stopCh \u0026#x3C;- \u003cspan class=\"hljs-keyword\"\u003estruct\u003c/span\u003e{}{} \u003cspan class=\"hljs-comment\"\u003e// ì›Œì»¤ì— ì¤‘ì§€ ì‹ í˜¸ ì „ì†¡\u003c/span\u003e\n }\n}\n\n\u003cspan class=\"hljs-comment\"\u003e// ScaleWorkersëŠ” í˜„ì¬ ë¶€í•˜ì— ë”°ë¼ ì›Œì»¤ ìˆ˜ë¥¼ ë™ì ìœ¼ë¡œ ì¡°ì •í•©ë‹ˆë‹¤.\u003c/span\u003e\n\u003cspan class=\"hljs-function\"\u003e\u003cspan class=\"hljs-keyword\"\u003efunc\u003c/span\u003e \u003cspan class=\"hljs-params\"\u003e(d *dispatcher)\u003c/span\u003e\u003c/span\u003e ScaleWorkers(minWorkers, maxWorkers, loadThreshold \u003cspan class=\"hljs-type\"\u003eint\u003c/span\u003e) {\n ticker := time.NewTicker(time.Microsecond)\n \u003cspan class=\"hljs-keyword\"\u003edefer\u003c/span\u003e ticker.Stop()\n\n \u003cspan class=\"hljs-keyword\"\u003efor\u003c/span\u003e \u003cspan class=\"hljs-keyword\"\u003erange\u003c/span\u003e ticker.C {\n  load := \u003cspan class=\"hljs-built_in\"\u003elen\u003c/span\u003e(d.inCh) \u003cspan class=\"hljs-comment\"\u003e// í˜„ì¬ ë¶€í•˜ëŠ” ì±„ë„ì— ëŒ€ê¸° ì¤‘ì¸ ìš”ì²­ ìˆ˜\u003c/span\u003e\n  \u003cspan class=\"hljs-keyword\"\u003eif\u003c/span\u003e load \u003e loadThreshold \u0026#x26;\u0026#x26; d.workerCount \u0026#x3C; maxWorkers {\n   fmt.Println(\u003cspan class=\"hljs-string\"\u003e\"ìŠ¤ì¼€ì¼ë§ íŠ¸ë¦¬ê±°\"\u003c/span\u003e)\n   newWorker := \u0026#x26;Worker{\n    Wg:         d.wg,\n    Id:         d.workerCount,\n    ReqHandler: ReqHandler,\n   }\n   d.AddWorker(newWorker)\n  } \u003cspan class=\"hljs-keyword\"\u003eelse\u003c/span\u003e \u003cspan class=\"hljs-keyword\"\u003eif\u003c/span\u003e load \u0026#x3C; \u003cspan class=\"hljs-number\"\u003e0.75\u003c/span\u003e*loadThreshold \u0026#x26;\u0026#x26; d.workerCount \u003e minWorkers {\n   fmt.Println(\u003cspan class=\"hljs-string\"\u003e\"ì¶•ì†Œ íŠ¸ë¦¬ê±°\"\u003c/span\u003e)\n   d.RemoveWorker(minWorkers)\n  }\n }\n}\n\n\u003cspan class=\"hljs-comment\"\u003e// LaunchWorkerëŠ” ì›Œì»¤ë¥¼ ì‹œì‘í•˜ê³  ì›Œì»¤ ìˆ˜ë¥¼ ì¦ê°€ì‹œí‚µë‹ˆë‹¤.\u003c/span\u003e\n\u003cspan class=\"hljs-function\"\u003e\u003cspan class=\"hljs-keyword\"\u003efunc\u003c/span\u003e \u003cspan class=\"hljs-params\"\u003e(d *dispatcher)\u003c/span\u003e\u003c/span\u003e LaunchWorker(id \u003cspan class=\"hljs-type\"\u003eint\u003c/span\u003e, w WorkerLauncher) {\n w.LaunchWorker(d.inCh, d.stopCh) \u003cspan class=\"hljs-comment\"\u003e// ì¤‘ì§€ ì±„ë„ì„ ì›Œì»¤ì— ì „ë‹¬\u003c/span\u003e\n d.mu.Lock()\n d.workerCount++\n d.mu.Unlock()\n}\n\n\u003cspan class=\"hljs-comment\"\u003e// MakeRequestëŠ” ìš”ì²­ì„ ì…ë ¥ ì±„ë„ì— ì¶”ê°€í•˜ê±°ë‚˜ ì±„ë„ì´ ê°€ë“ ì°¬ ê²½ìš° ì‚­ì œí•©ë‹ˆë‹¤.\u003c/span\u003e\n\u003cspan class=\"hljs-function\"\u003e\u003cspan class=\"hljs-keyword\"\u003efunc\u003c/span\u003e \u003cspan class=\"hljs-params\"\u003e(d *dispatcher)\u003c/span\u003e\u003c/span\u003e MakeRequest(r Request) {\n \u003cspan class=\"hljs-keyword\"\u003eselect\u003c/span\u003e {\n \u003cspan class=\"hljs-keyword\"\u003ecase\u003c/span\u003e d.inCh \u0026#x3C;- r:\n \u003cspan class=\"hljs-keyword\"\u003edefault\u003c/span\u003e:\n  \u003cspan class=\"hljs-comment\"\u003e// ì±„ë„ì´ ê°€ë“ ì°¬ ê²½ìš° ì²˜ë¦¬\u003c/span\u003e\n  fmt.Println(\u003cspan class=\"hljs-string\"\u003e\"ìš”ì²­ ì±„ë„ì´ ê°€ë“ ì°¼ìŠµë‹ˆë‹¤. ìš”ì²­ ì‚­ì œë¨.\"\u003c/span\u003e)\n  \u003cspan class=\"hljs-comment\"\u003e// ë‹¤ë¥¸ ì¡°ì¹˜ë¥¼ ì·¨í•˜ê¸° ì „ì— ë¡œê¹…, ìš”ì²­ ë²„í¼ë§ ë˜ëŠ” ë‹¤ë¥¸ ì¡°ì¹˜ë¥¼ ì·¨í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.\u003c/span\u003e\n }\n}\n\n\u003cspan class=\"hljs-comment\"\u003e// StopëŠ” ëª¨ë“  ì›Œì»¤ë¥¼ ì •ìƒì ìœ¼ë¡œ ì¢…ë£Œí•˜ê³  ì²˜ë¦¬ê°€ ì™„ë£Œë  ë•Œê¹Œì§€ ê¸°ë‹¤ë¦½ë‹ˆë‹¤.\u003c/span\u003e\n\u003cspan class=\"hljs-function\"\u003e\u003cspan class=\"hljs-keyword\"\u003efunc\u003c/span\u003e \u003cspan class=\"hljs-params\"\u003e(d *dispatcher)\u003c/span\u003e\u003c/span\u003e Stop(ctx context.Context) {\n fmt.Println(\u003cspan class=\"hljs-string\"\u003e\"\\nì¤‘ì§€ í˜¸ì¶œë¨\"\u003c/span\u003e)\n \u003cspan class=\"hljs-built_in\"\u003eclose\u003c/span\u003e(d.inCh) \u003cspan class=\"hljs-comment\"\u003e// ë” ì´ìƒ ìš”ì²­ì„ ë³´ë‚´ì§€ ì•ŠìŒì„ ì•Œë¦¬ê¸° ìœ„í•´ ì…ë ¥ ì±„ë„ ë‹«ê¸°\u003c/span\u003e\n done := \u003cspan class=\"hljs-built_in\"\u003emake\u003c/span\u003e(\u003cspan class=\"hljs-keyword\"\u003echan\u003c/span\u003e \u003cspan class=\"hljs-keyword\"\u003estruct\u003c/span\u003e{})\n\n \u003cspan class=\"hljs-keyword\"\u003ego\u003c/span\u003e \u003cspan class=\"hljs-function\"\u003e\u003cspan class=\"hljs-keyword\"\u003efunc\u003c/span\u003e\u003cspan class=\"hljs-params\"\u003e()\u003c/span\u003e\u003c/span\u003e {\n  d.wg.Wait() \u003cspan class=\"hljs-comment\"\u003e// ëª¨ë“  ì›Œì»¤ê°€ ì¢…ë£Œë  ë•Œê¹Œì§€ ëŒ€ê¸°\u003c/span\u003e\n  \u003cspan class=\"hljs-built_in\"\u003eclose\u003c/span\u003e(done)\n }()\n\n \u003cspan class=\"hljs-keyword\"\u003eselect\u003c/span\u003e {\n \u003cspan class=\"hljs-keyword\"\u003ecase\u003c/span\u003e \u0026#x3C;-done:\n  fmt.Println(\u003cspan class=\"hljs-string\"\u003e\"ëª¨ë“  ì›Œì»¤ê°€ ì •ìƒì ìœ¼ë¡œ ì¤‘ì§€ë¨\"\u003c/span\u003e)\n \u003cspan class=\"hljs-keyword\"\u003ecase\u003c/span\u003e \u0026#x3C;-ctx.Done():\n  fmt.Println(\u003cspan class=\"hljs-string\"\u003e\"ì‹œê°„ ì´ˆê³¼, ê°•ì œ ì¢…ë£Œ\"\u003c/span\u003e)\n  \u003cspan class=\"hljs-comment\"\u003e// ì‹œê°„ ì´ˆê³¼ ì‹œ ëª¨ë“  ì›Œì»¤ ê°•ì œ ì¢…ë£Œ\u003c/span\u003e\n  \u003cspan class=\"hljs-keyword\"\u003efor\u003c/span\u003e i := \u003cspan class=\"hljs-number\"\u003e0\u003c/span\u003e; i \u0026#x3C; d.workerCount; i++ {\n   d.stopCh \u0026#x3C;- \u003cspan class=\"hljs-keyword\"\u003estruct\u003c/span\u003e{}{}\n  }\n }\n\n d.wg.Wait()\n}\n\n\u003cspan class=\"hljs-comment\"\u003e// NewDispatcherëŠ” ë²„í¼ë§ëœ ì±„ë„ê³¼ ì›¨ì´íŠ¸ ê·¸ë£¹ì´ ìˆëŠ” ìƒˆë¡œìš´ ë””ìŠ¤íŒ¨ì²˜ë¥¼ ìƒì„±í•©ë‹ˆë‹¤.\u003c/span\u003e\n\u003cspan class=\"hljs-function\"\u003e\u003cspan class=\"hljs-keyword\"\u003efunc\u003c/span\u003e \u003cspan class=\"hljs-title\"\u003eNewDispatcher\u003c/span\u003e\u003cspan class=\"hljs-params\"\u003e(b \u003cspan class=\"hljs-type\"\u003eint\u003c/span\u003e, wg *sync.WaitGroup, maxWorkers \u003cspan class=\"hljs-type\"\u003eint\u003c/span\u003e)\u003c/span\u003e\u003c/span\u003e Dispatcher {\n \u003cspan class=\"hljs-keyword\"\u003ereturn\u003c/span\u003e \u0026#x26;dispatcher{\n  inCh:   \u003cspan class=\"hljs-built_in\"\u003emake\u003c/span\u003e(\u003cspan class=\"hljs-keyword\"\u003echan\u003c/span\u003e Request, b),\n  wg:     wg,\n  stopCh: \u003cspan class=\"hljs-built_in\"\u003emake\u003c/span\u003e(\u003cspan class=\"hljs-keyword\"\u003echan\u003c/span\u003e \u003cspan class=\"hljs-keyword\"\u003estruct\u003c/span\u003e{}, maxWorkers), \u003cspan class=\"hljs-comment\"\u003e// ë¸”ë¡œí‚¹ì„ ë°©ì§€í•˜ê¸° ìœ„í•œ ë²„í¼ë§ëœ ì±„ë„\u003c/span\u003e\n }\n}\n\u003c/code\u003e\u003c/pre\u003e\n\u003ch3\u003emain.go\u003c/h3\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-go\"\u003e\u003cspan class=\"hljs-keyword\"\u003epackage\u003c/span\u003e main\n\n\u003cspan class=\"hljs-keyword\"\u003eimport\u003c/span\u003e (\n \u003cspan class=\"hljs-string\"\u003e\"context\"\u003c/span\u003e\n \u003cspan class=\"hljs-string\"\u003e\"fmt\"\u003c/span\u003e\n \u003cspan class=\"hljs-string\"\u003e\"runtime\"\u003c/span\u003e\n \u003cspan class=\"hljs-string\"\u003e\"sync\"\u003c/span\u003e\n \u003cspan class=\"hljs-string\"\u003e\"time\"\u003c/span\u003e\n wp \u003cspan class=\"hljs-string\"\u003e\"workerpool/workerpool\"\u003c/span\u003e\n)\n\n\n\n\u0026#x3C;div class=\u003cspan class=\"hljs-string\"\u003e\"content-ad\"\u003c/span\u003e\u003e\u0026#x3C;/div\u003e\n\n# ë©”ì¸\n\nì£¼ìš” ê¸°ëŠ¥ì€ ë””ìŠ¤íŒ¨ì²˜ì™€ ì›Œì»¤ë¥¼ ì´ˆê¸°í™”í•˜ê³  ì‘ì—…ì„ ë³´ë‚´ë©°, ë””ìŠ¤íŒ¨ì²˜ë¥¼ ì›í™œí•˜ê²Œ ì¢…ë£Œí•©ë‹ˆë‹¤.\n\n- GOMAXPROCSë¥¼ ì‚¬ìš© ê°€ëŠ¥í•œ CPU ìˆ˜ë¡œ ì„¤ì •í•©ë‹ˆë‹¤.\n- ë””ìŠ¤íŒ¨ì²˜ë¥¼ ì´ˆê¸°í™”í•˜ê³  ì´ˆê¸° ì›Œì»¤ ì§‘í•©ì„ ì‹œì‘í•©ë‹ˆë‹¤.\n- ë””ìŠ¤íŒ¨ì²˜ì— ìš”ì²­ì„ ë³´ëƒ…ë‹ˆë‹¤.\n- íƒ€ì„ì•„ì›ƒì„ ì„¤ì •í•˜ì—¬ ë””ìŠ¤íŒ¨ì²˜ë¥¼ ì›í™œí•˜ê²Œ ì¢…ë£Œí•©ë‹ˆë‹¤.\n\nìš°ë¦¬ëŠ” ì»¨í…ìŠ¤íŠ¸ íƒ€ì„ì•„ì›ƒ, ë²„í¼ í¬ê¸°, ìµœì†Œ/ìµœëŒ€ ì›Œì»¤ì™€ ê°™ì€ ë§¤ê°œë³€ìˆ˜ë¥¼ ì¡°ì •í•˜ì—¬ ì´ˆë‹¹ ìš”ì²­(RPS)ì„ ìµœëŒ€í™”í•˜ê³  ì• í”Œë¦¬ì¼€ì´ì…˜ ì„±ëŠ¥ì„ í–¥ìƒì‹œí‚¬ ê²ƒì…ë‹ˆë‹¤.\n\n\u0026#x3C;div class=\u003cspan class=\"hljs-string\"\u003e\"content-ad\"\u003c/span\u003e\u003e\u0026#x3C;/div\u003e\n\nStay tuned \u003cspan class=\"hljs-keyword\"\u003efor\u003c/span\u003e practical insights and \u003cspan class=\"hljs-built_in\"\u003ereal\u003c/span\u003e-world examples!\n\nIf you\u003cspan class=\"hljs-string\"\u003e've read up till now, I hope you enjoyed this article. If you did, please show your support by giving it a clap, as it helps me stay motivated to assist the community.\n\nFeel free to leave a comment if you noticed any discrepancies in this article or if you have any questions related to the content.\n\nThank you for your time.\n\n\u0026#x3C;div class=\"content-ad\"\u003e\u0026#x3C;/div\u003e\n\në§ˆìŒì— ë“œì‹œëŠ” ì‚¬ëŒë“¤ê³¼ ì–¸ì œë“  ì—°ë½í•˜ì„¸ìš”! LinkedInì— ì—°ê²°í•´ë³´ëŠ” ê±´ ì–´ë– ì„¸ìš”? ğŸ¤\n\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\n\u003c/body\u003e\n\u003c/html\u003e\n"},"__N_SSG":true},"page":"/post/[slug]","query":{"slug":"2024-05-27-MasteringConcurrentProcessingAStep-by-StepGuidetoBuildingaScalableWorkerPoolinGo"},"buildId":"pS12KbT5cDEZt16dno2Ez","isFallback":false,"gsp":true,"scriptLoader":[{"async":true,"src":"https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-4877378276818686","strategy":"lazyOnload","crossOrigin":"anonymous"}]}</script></body></html>